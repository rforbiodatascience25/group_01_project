<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>00_all</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="00_all_files/libs/clipboard/clipboard.min.js"></script>
<script src="00_all_files/libs/quarto-html/quarto.js"></script>
<script src="00_all_files/libs/quarto-html/popper.min.js"></script>
<script src="00_all_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="00_all_files/libs/quarto-html/anchor.min.js"></script>
<link href="00_all_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="00_all_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="00_all_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="00_all_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="00_all_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="00_all_files/libs/table1-1.0/table1_defaults.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">00_all</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="all" class="level1">
<h1>All</h1>
<section id="loading-libraries" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries">Loading libraries</h2>
</section>
</section>
<section id="loading-data" class="level1">
<h1>Loading data</h1>
<section id="loading-libraries-1" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-1">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"GEOquery"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="make-_raw-dir" class="level3">
<h3 class="anchored" data-anchor-id="make-_raw-dir">Make _raw dir</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data dirs</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">"../data/"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>raw_dir <span class="ot">&lt;-</span> <span class="st">"../data/_raw/"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(data_dir)) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(data_dir)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(raw_dir)) {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(raw_dir)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#dir.create("../_raw/")</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#dir.create("../data/")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-geo-data-using-geoquery" class="level3">
<h3 class="anchored" data-anchor-id="loading-geo-data-using-geoquery">Loading GEO data using GEOquery</h3>
<p><a href="https://warwick.ac.uk/fac/sci/moac/people/students/peter_cock/r/geo/" class="uri">https://warwick.ac.uk/fac/sci/moac/people/students/peter_cock/r/geo/</a></p>
<p>On the GEO database, files are stored as .soft files, with metadata in the beginning and (for the case of “GSE11223”) gene expression data at the end.</p>
<p>The getGEO function from GEOquery obtains queries GEO datasets with the GEO id (if specified). In this case for GSE11223. Else, filename can be supplied to import a downloaded file from the GEO database</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gse11223 <span class="ot">&lt;-</span> <span class="fu">getGEO</span>(<span class="at">GEO=</span><span class="st">"GSE11223"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>gds3268 <span class="ot">&lt;-</span> <span class="fu">getGEO</span>(<span class="at">GEO=</span><span class="st">"GDS3268"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Making raw data files</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gds3268, <span class="at">file=</span><span class="fu">file.path</span>(raw_dir,<span class="st">"/raw_expression_data.rds"</span>))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gse11223, <span class="at">file=</span><span class="fu">file.path</span> (raw_dir,<span class="st">"/raw_meta_data.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="working-with-the-raw-gse-data" class="level4">
<h4 class="anchored" data-anchor-id="working-with-the-raw-gse-data">Working with the raw “gse” data</h4>
<p>For GSE11223, getGEO pulls the data into a list of length 1. The file GSE11223_series_matrix.txt.gz is extracted into the first (and only) position of that list. We therefore extract the data, getting rid of the parent list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>gse11223 <span class="ot">&lt;-</span> gse11223<span class="sc">$</span>GSE11223_series_matrix.txt.gz</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the gse11223 variable is a “Large ExpressionSet” of 44.1MB.</p>
</section>
<section id="working-with-the-curated-gds-data" class="level4">
<h4 class="anchored" data-anchor-id="working-with-the-curated-gds-data">Working with the curated “gds” data</h4>
<p>gds3268 is the curated dataset for the project, meaning that the meta data of samples and the expression table can be easily extracted using Meta() and Table() respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>gds3268_meta <span class="ot">&lt;-</span> <span class="fu">Meta</span>(gds3268)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gds3268)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>gds3268_expression <span class="ot">&lt;-</span> <span class="fu">Table</span>(gds3268)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>( gds3268_expression, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID_REF      IDENTIFIER GSM282855 GSM282856 GSM282857 GSM282858 GSM282859
1   14657          RNF166 -0.311730 -0.338660 -0.564050 -0.352500 -0.185880
2    2442            EBPL -0.230920 -0.135210 -0.167870 -0.217400 -0.228500
3   14724 NegativeControl        NA        NA        NA        NA        NA
4   30669    A_24_P161235  0.011009  0.056945  0.000937  0.074133 -0.028607
5    6309           RBM28 -0.317270 -0.329240 -0.284000 -0.268910 -0.297990
6   28377       HIST1H2AK -0.036610        NA        NA -0.004166        NA
7   24950          CSRNP1  0.025155  0.018690 -0.106620 -0.092854  0.020449
8   34504             EQC        NA        NA        NA        NA        NA
9   27082            SMG8  0.066755  0.115240  0.148900  0.037746 -0.042993
10  17786           HOXA9  0.697040  0.690640  1.108300  0.872790  0.884120
   GSM282860 GSM282861 GSM282862 GSM282863 GSM282864 GSM282865 GSM282866
1  -0.207920 -0.387650 -0.222110 -0.174860 -0.465770 -0.500170 -0.537190
2  -0.058537 -0.305930 -0.075628 -0.068494 -0.041895 -0.109490 -0.173350
3         NA        NA        NA        NA        NA        NA        NA
4  -0.012805  0.175940  0.076094  0.030862 -0.023264  0.079431 -0.013641
5  -0.146530 -0.156640 -0.332730 -0.258080 -0.241450 -0.306280 -0.331760
6         NA        NA        NA        NA        NA -0.019431        NA
7  -0.000669  0.231260 -0.150540 -0.002461  0.075974  0.061907  0.047064
8         NA        NA        NA        NA        NA        NA        NA
9  -0.006155  0.034914  0.034337  0.100510  0.136440  0.009839  0.068346
10  0.705980  0.857590  0.849020  0.884110  0.953350  0.888340  0.774120
   GSM282867 GSM282868 GSM282869 GSM282870 GSM282871 GSM282872 GSM282904
1  -0.457690 -0.456040 -0.676270 -0.614760 -0.280120 -0.535450 -0.562690
2  -0.097827 -0.071885 -0.478160 -0.185260 -0.218310 -0.050655 -1.119700
3         NA        NA        NA        NA        NA        NA        NA
4   0.020978 -0.009096  0.133210  0.227360  0.062824  0.078983  0.140860
5  -0.369020 -0.247770 -0.223590 -0.133410 -0.264440 -0.341010  0.641680
6  -0.089373 -0.156800 -0.297870 -0.141270 -0.185850 -0.480310        NA
7  -0.106150 -0.154330 -0.026903 -0.055293 -0.036367 -0.067443 -0.003046
8         NA        NA        NA        NA        NA        NA        NA
9   0.011903  0.061343  0.086755  0.122900  0.083122  0.117270  0.297110
10  0.881610  0.770220  0.689670  0.758360  0.422500  1.098500  0.206780
   GSM282910 GSM282913 GSM282915 GSM282921 GSM282927 GSM282873 GSM282874
1  -0.291470 -0.184090 -0.582390 -0.259760  -0.44550 -0.722500 -0.265070
2  -0.060030 -0.275700 -0.243220 -0.185490  -0.13478 -0.812080 -0.379540
3         NA        NA        NA        NA        NA        NA        NA
4  -0.133960 -0.017954 -0.093363  0.036556   0.12167  0.039883 -0.026234
5  -0.205240 -0.182740 -0.176280  0.046865  -0.12951 -0.317270 -0.362000
6         NA        NA -0.005359 -0.176750  -0.11551        NA -0.249070
7  -0.017539 -0.108590  0.011793  0.200450  -0.30634 -0.084596 -0.179270
8         NA        NA        NA        NA        NA        NA        NA
9   0.105180  0.072600  0.066500  0.111450   0.17440  0.163290  0.029927
10  0.986650  0.816140  0.834480  0.779310   0.96858  1.003600  1.047600
   GSM282875 GSM282905 GSM282914 GSM282918 GSM282876 GSM282877 GSM282878
1  -0.257340  0.038632 -0.798040 -0.499390  -0.43777 -0.205500 -0.164170
2  -0.313820 -0.571650 -1.014500 -1.016200  -0.43745 -0.167880 -0.291790
3         NA        NA        NA        NA        NA        NA        NA
4  -0.064462 -0.078734 -0.017231  0.045026   0.22950 -0.137640 -0.007445
5  -0.231460 -0.171960  0.083592 -0.108290  -0.17377 -0.266760 -0.265890
6         NA        NA        NA -0.224910        NA -0.072144 -0.017678
7  -0.183560  0.058155  0.184910  0.138770   0.05212 -0.024314  0.137030
8         NA        NA        NA        NA        NA        NA        NA
9   0.047558 -0.058543  0.211060  0.115680   0.13181  0.149430  0.102940
10  0.926360  0.769830  0.631500  0.789390   0.99293  1.009000  0.842790
   GSM282879 GSM282880 GSM282881 GSM282882 GSM282883 GSM282884 GSM282885
1  -0.076161 -0.187050 -0.514570 -0.510780 -0.447400 -0.656560 -0.176630
2  -0.385910 -0.133380 -0.484670 -0.348790 -0.247580 -0.324580 -0.231910
3         NA        NA        NA        NA        NA        NA        NA
4   0.099930 -0.153620  0.068930  0.071452 -0.074344  0.166590 -0.016452
5  -0.232540 -0.142850 -0.018468  0.326690 -0.140690  0.072913 -0.236790
6         NA -0.128690        NA        NA        NA        NA        NA
7   0.035926  0.030167  0.059063  0.149910  0.045493  0.116560  0.060354
8         NA        NA        NA        NA        NA        NA        NA
9   0.056158  0.184620  0.063886  0.157960  0.118360  0.009111  0.132600
10  1.127400  0.916040  0.980020  0.891110  1.210800  1.032500  1.134000
   GSM282886 GSM282887 GSM282888 GSM282889 GSM282890 GSM282902 GSM282903
1  -0.573410 -0.537180 -0.269060 -0.173550 -0.375030 -0.087126 -0.806870
2  -0.317710 -0.399860 -0.126970 -0.179150 -0.238850 -0.183280 -0.406450
3         NA        NA        NA        NA        NA        NA        NA
4   0.037842  0.092559  0.016248  0.029135  0.162130 -0.109340 -0.015773
5  -0.232640  0.156980 -0.235630 -0.303800 -0.072956 -0.268990 -0.269380
6         NA        NA -0.082168        NA        NA -0.098346        NA
7  -0.011427  0.032939  0.121540  0.272970 -0.015620 -0.120770  0.013015
8         NA        NA        NA        NA        NA        NA        NA
9   0.423730  0.038034  0.134150  0.066214 -0.001881  0.202720 -0.015752
10  1.161100  1.318600  1.221400  0.789770  1.175000  0.909980  0.939610
   GSM282907 GSM282909 GSM282912 GSM282920 GSM282924 GSM282891 GSM282892
1  -0.442050 -0.475140 -0.310690 -0.304780 -0.360390 -0.622590 -0.349600
2  -0.417790 -0.214390 -0.203200 -0.293720 -0.070768 -0.587380 -0.238450
3         NA        NA        NA        NA        NA        NA        NA
4   0.024140 -0.022531 -0.024578  0.263860  0.087667  0.299950  0.218760
5  -0.218940 -0.153420 -0.348150  0.010738 -0.265510  0.202830 -0.202500
6         NA        NA        NA -0.228360 -0.067460 -0.135000 -0.038861
7  -0.043399 -0.063976 -0.050692  0.037636 -0.071158  0.173940  0.029572
8         NA        NA        NA        NA        NA        NA        NA
9   0.124510  0.041432  0.162890  0.037017  0.023687  0.093538  0.039121
10  0.963590  1.009800  1.139800  0.933740  0.919210  0.599030  0.908310
   GSM282893 GSM282894 GSM282895 GSM282896 GSM282897 GSM282898 GSM282899
1   -0.47072 -0.512950 -0.350580 -0.611350  -0.39416 -0.584420 -0.319550
2   -0.29965 -0.498960 -0.158210 -0.085150  -0.19934 -0.343250 -0.337340
3         NA        NA        NA        NA        NA        NA        NA
4    0.26818  0.297710 -0.025881  0.137170   0.06583  0.163360  0.072916
5   -0.14991  0.024690 -0.169560  0.048085  -0.22942 -0.120440 -0.076485
6         NA -0.061124 -0.405120 -0.221650  -0.22988 -0.174230        NA
7    0.10794 -0.001187  0.228280  0.032123  -0.10938 -0.033972  0.138850
8         NA        NA        NA        NA        NA        NA        NA
9    0.11056  0.051462  0.082139  0.006037   0.21709  0.153550  0.065787
10   0.95383  1.183900  1.197500  1.046800   1.04580  0.976830  1.038500
   GSM282900 GSM282901 GSM282906 GSM282908 GSM282911 GSM282916 GSM282919
1  -0.302810 -0.261910 -0.491640 -0.252560 -0.673330 -0.175160 -0.237800
2   0.050937 -0.156450 -0.356840 -0.848060 -0.209460 -0.353780 -0.167460
3         NA        NA        NA        NA        NA        NA        NA
4   0.101730  0.040161  0.028464  0.565570 -0.051150  0.172580  0.041808
5  -0.010682 -0.156620 -0.120800  0.342880 -0.312620 -0.156240 -0.169080
6  -0.209970 -0.392740 -0.146400        NA        NA        NA        NA
7  -0.123060  0.218210  0.049501  0.018638 -0.160770 -0.039538 -0.069697
8         NA        NA        NA        NA        NA        NA        NA
9   0.065195  0.056012  0.100100  0.473130  0.054043  0.109310  0.061488
10  1.130000  1.030100  1.084400  0.259190  1.081900  0.864230  1.146600
   GSM282923 GSM282917 GSM282922 GSM282926 GSM282925 GSM282935 GSM282938
1  -0.620930 -0.476680 -0.332610 -0.527230 -0.509250 -0.221460 -0.371540
2  -0.209050 -0.089029 -0.238120 -0.039266 -0.042005 -0.157740 -0.078976
3         NA        NA        NA        NA        NA        NA        NA
4   0.021787  0.169800  0.133070  0.119090 -0.017883  0.082268  0.027008
5  -0.262330 -0.226130 -0.338000 -0.271240 -0.200680 -0.257200 -0.418330
6         NA  0.128620 -0.078017        NA        NA -0.066224        NA
7   0.054538 -0.122200 -0.214340 -0.217090 -0.213260 -0.125350 -0.307110
8         NA        NA        NA        NA        NA        NA        NA
9   0.099626 -0.002301  0.070181  0.128910  0.029767 -0.018421  0.050355
10  0.898110  0.804720  0.780410  0.812770  0.810340  1.177800  0.984860
   GSM282940 GSM282941 GSM282943 GSM282944 GSM282946 GSM282947 GSM282948
1  -0.139130 -0.307320  -0.36934 -0.305380 -0.485290 -0.493080 -0.702400
2  -0.116020 -0.103470  -0.42729 -0.107200 -0.195190 -0.185000 -0.044761
3         NA        NA        NA        NA        NA        NA        NA
4   0.034290  0.005174   0.13511  0.050356  0.108760 -0.055345  0.029125
5  -0.314760 -0.373130  -0.12458 -0.276460 -0.350890 -0.416030 -0.364740
6  -0.121500  0.226430        NA        NA -0.013352        NA        NA
7  -0.010765 -0.020471  -0.15258 -0.010321 -0.045788  0.065941 -0.077879
8         NA        NA        NA        NA        NA        NA        NA
9   0.011464  0.094133   0.17372  0.082968  0.080606  0.092026  0.074775
10  0.918350  0.940190   0.97752  0.843220  0.894710  0.957450  0.777570
   GSM282949 GSM282950 GSM282951 GSM282952 GSM282953 GSM282955 GSM282956
1  -0.493830 -0.595880 -0.653860 -0.724590 -0.602110 -0.578590 -0.605040
2  -0.175530 -0.446970 -0.087399 -0.151420 -0.105110 -0.201230 -0.582920
3         NA        NA        NA        NA        NA        NA        NA
4   0.071479  0.145310  0.073908 -0.036037  0.117600  0.090965  0.344370
5  -0.352010 -0.289180 -0.474920 -0.418900 -0.411660 -0.305130 -0.300130
6         NA -0.006155        NA -0.074957        NA        NA        NA
7  -0.030353 -0.061447  0.074993 -0.015708 -0.122620 -0.089259  0.016599
8         NA        NA        NA        NA        NA        NA        NA
9   0.064533  0.058610  0.130970  0.107200  0.024069  0.142930  0.110970
10  0.903230  0.606720  0.787470  1.171000  0.828450  0.914880  0.734210
   GSM282959 GSM282966 GSM282968 GSM282974 GSM283016 GSM283021 GSM283024
1  -0.508530 -0.641590 -0.468090 -0.213070 -0.632260 -0.722640 -0.542990
2  -0.022221 -0.159930 -0.037316  0.046041 -0.724960 -0.466250 -0.354910
3         NA        NA        NA        NA        NA        NA        NA
4   0.120730  0.073264  0.041934 -0.054600  0.167170  0.303330  0.408690
5  -0.354150 -0.359490 -0.334460 -0.363570  0.323620  0.426410  0.352110
6  -0.086490 -0.323920 -0.106720 -0.057256 -0.219200        NA -0.152590
7  -0.193640  0.187880  0.028487 -0.054171 -0.130630 -0.065334 -0.222040
8         NA        NA        NA        NA        NA        NA        NA
9   0.107630  0.069888  0.095354 -0.007193  0.046916 -0.024073 -0.016479
10  1.093200  0.681820  0.875780  0.960120  0.393560  0.967160  1.105600
   GSM283041 GSM283043 GSM282957 GSM282958 GSM282960 GSM282971 GSM283015
1  -0.268160 -0.558460 -0.147600 -0.402170 -0.619830 -0.082104 -0.442640
2  -0.412810 -0.083827 -0.510700 -0.382690  0.098030 -0.380100 -0.652970
3         NA        NA        NA        NA        NA        NA        NA
4   0.088476 -0.046715 -0.142770 -0.055932  0.042249 -0.071599  0.135820
5   0.282120 -0.266680 -0.337130 -0.451020 -0.283340 -0.250050 -0.062378
6  -0.301670 -0.144330 -0.188180        NA -0.135160  0.045525        NA
7  -0.290370 -0.107010 -0.059308 -0.141780 -0.093014 -0.156710 -0.095341
8         NA        NA        NA        NA        NA        NA        NA
9   0.002892  0.091733  0.000977  0.106190 -0.025570 -0.027245  0.071684
10  0.707170  0.825000  1.026400  1.156600  1.181600  0.797210  0.768170
   GSM282962 GSM282963 GSM282977 GSM282978 GSM282987 GSM282988 GSM282989
1  -0.115300 -0.549310 -0.348970  -0.39380 -0.278870 -0.087406 -0.340570
2  -0.202440 -0.313690 -0.188270  -0.22647 -0.234210 -0.428790 -0.203690
3         NA        NA        NA        NA        NA        NA        NA
4  -0.095684 -0.129370 -0.073875  -0.16651  0.157190 -0.111860  0.078487
5  -0.290410 -0.356160 -0.228620  -0.31504 -0.253280 -0.225770 -0.156510
6  -0.434760 -0.048652        NA        NA        NA -0.070631        NA
7  -0.000674  0.145820 -0.038497  -0.15542 -0.032643  0.026903 -0.051519
8         NA        NA        NA        NA        NA        NA        NA
9   0.060516  0.201570  0.035781   0.20253  0.047671  0.022153  0.073778
10  0.889520  1.053400  1.142800   1.00640  0.988280  1.022000  1.138000
   GSM282990 GSM282991 GSM282992 GSM282993 GSM282994 GSM282995 GSM283020
1  -0.386640 -0.145710 -0.155260 -0.068740 -0.398340 -0.142940 -0.446290
2  -0.195310 -0.197560 -0.281680 -0.171830 -0.202000 -0.248910 -0.366480
3         NA        NA        NA        NA        NA        NA        NA
4  -0.087272  0.042968  0.033125  0.149760 -0.099838 -0.094193  0.292220
5  -0.260940 -0.252170 -0.172990 -0.024339 -0.231580 -0.265450  0.194600
6  -0.610230        NA -0.270010 -0.188140        NA        NA -0.160710
7  -0.084232 -0.102410 -0.025367  0.131400 -0.070037 -0.033563 -0.083754
8         NA        NA        NA        NA        NA        NA        NA
9  -0.129060  0.130540  0.075247  0.063011  0.032010  0.115520 -0.025053
10  1.152100  0.879250  0.977380  0.839150  1.059900  0.855300  1.158900
   GSM283023 GSM282931 GSM282939 GSM282981 GSM282983 GSM282985 GSM283000
1  -0.681150 -0.304070 -0.234740 -0.351330 -0.397250 -0.290070 -0.275710
2  -0.852580 -0.081414 -0.100690 -0.215350 -0.148610 -0.080020 -0.065023
3         NA        NA        NA        NA        NA        NA        NA
4   0.366390 -0.012572  0.012292  0.041862 -0.033448        NA  0.038352
5   0.313020 -0.263570 -0.330360 -0.193880 -0.198170 -0.296950 -0.175210
6         NA -0.063893        NA -0.169910 -0.202200        NA -0.339000
7  -0.023228  0.122290 -0.045581 -0.050384  0.002654  0.092599 -0.045402
8         NA        NA        NA        NA        NA        NA        NA
9  -0.006203  0.040950  0.052171  0.092414  0.115170  0.071716 -0.103600
10  0.807010  0.949570  1.223200  0.967110  0.951390  1.150900  1.183000
   GSM283001 GSM283002 GSM283003 GSM283004 GSM283005 GSM283006 GSM283007
1  -0.141230 -0.415040 -0.402690  -0.43851 -0.688890  -0.70242 -0.389010
2  -0.430020 -0.041670 -0.116790  -0.25034 -0.636660  -0.41992 -0.116930
3         NA        NA        NA        NA        NA        NA        NA
4   0.160850  0.050649  0.046033   0.11900  0.072364   0.22054  0.058032
5   0.374030 -0.283560 -0.225180  -0.13213 -0.117450  -0.12081 -0.183890
6  -0.323580        NA -0.022807  -0.49874 -0.169900        NA -0.118150
7   0.099842 -0.153270 -0.103050  -0.13026 -0.023290  -0.13652 -0.181610
8         NA        NA        NA        NA        NA        NA        NA
9   0.018306 -0.020340 -0.118490   0.11855  0.139020   0.10122  0.162030
10  1.037600  1.213400  1.317800   1.12500  1.102100   1.00620  0.939660
   GSM283008 GSM283009 GSM283010 GSM283011 GSM283022 GSM283034 GSM283049
1  -0.676860 -0.736250  -0.17645  -0.63429 -0.435840 -0.299820 -0.522320
2  -0.114830 -0.164420  -0.31580  -0.19063 -0.247180 -0.202700 -0.102970
3         NA        NA        NA        NA        NA        NA        NA
4   0.113290  0.213730   0.23545   0.26146  0.214350  0.026416  0.170210
5  -0.136650 -0.047013  -0.19440  -0.01320 -0.008070 -0.135110 -0.299050
6  -0.001665 -0.049753  -0.49838  -0.46024 -0.303570 -0.009224 -0.184170
7   0.078233  0.116670  -0.10539  -0.15592  0.044182 -0.117240 -0.008713
8         NA        NA        NA        NA        NA        NA        NA
9   0.059065  0.174580   0.12128   0.21961  0.048831  0.040769  0.048944
10  0.844280  0.857270   1.00350   1.21250  1.219700  0.891620  1.526600
   GSM283051 GSM282929 GSM282933 GSM282936 GSM282937 GSM282942 GSM282945
1  -0.147100 -0.180170  -0.35327  0.055965  -0.28504 -0.257310 -0.299730
2  -0.659950 -0.050412  -0.17750 -0.403490  -0.48832 -0.222860 -0.242980
3         NA        NA        NA        NA        NA        NA        NA
4   0.203480 -0.013764   0.10240  0.117160   0.30692  0.098517  0.015132
5   0.282180 -0.350140  -0.21532 -0.176870   0.44969 -0.223590 -0.192170
6  -0.032873        NA  -0.14535        NA        NA        NA        NA
7  -0.195510  0.161220   0.17085 -0.072957  -0.10305  0.178580  0.104880
8         NA        NA        NA        NA        NA        NA        NA
9   0.216090  0.005111  -0.11417  0.045513   0.20224  0.032509  0.121070
10  1.020200  0.881730   0.89652  0.721490   0.28389  0.538700  0.899170
   GSM282954 GSM282961 GSM282964 GSM282965 GSM282967 GSM282969 GSM282970
1  -0.405240  -0.65259 -0.013711 -0.685940 -0.553560 -0.452080 -0.142480
2  -0.195530  -0.52024 -0.322460 -0.206140 -0.263590 -0.262970 -0.291720
3         NA        NA        NA        NA        NA        NA        NA
4  -0.054481   0.12037  0.089247  0.121950  0.071948  0.169410  0.108420
5  -0.375520  -0.51521 -0.258360 -0.223700 -0.299230 -0.357120 -0.266610
6   0.051508        NA        NA        NA -0.032802 -0.065994        NA
7   0.059977  -0.17140  0.274190  0.211370 -0.070666 -0.084527  0.195400
8         NA        NA        NA        NA        NA        NA        NA
9   0.111070   0.11331  0.052182 -0.007045  0.128010  0.082040  0.025547
10  1.100800   0.66363  0.452430  1.000300  0.908680  0.661410  0.706110
   GSM282972 GSM282973 GSM282975 GSM282996 GSM282999 GSM283014 GSM283019
1  -0.402040 -0.790280 -0.332020 -0.636580  -0.47747 -0.378210  -0.42913
2  -0.292830 -0.460910 -0.123310 -0.406630  -0.23015 -0.618890  -0.30569
3         NA        NA        NA        NA        NA        NA        NA
4   0.040741 -0.030511 -0.061177  0.205390   0.18403  0.534770   0.07501
5  -0.314970 -0.330970 -0.391420  0.971470   0.15215  0.578450   0.19117
6   0.141390 -0.130550  0.015615        NA  -0.52345 -0.596480        NA
7  -0.076117 -0.082323 -0.031835  0.115750   0.16918  0.032949  -0.17187
8         NA        NA        NA        NA        NA        NA        NA
9  -0.037967  0.154890  0.151990  0.050239  -0.26597  0.088046  -0.14340
10  0.792100  0.667680  1.087800  0.491650   0.71684  0.399550   1.21310
   GSM283026 GSM283029 GSM283030 GSM283033 GSM283035 GSM283036 GSM283038
1  -0.290020 -0.524180  -0.28147 -0.353970 -0.267370 -0.314450 -0.334280
2  -0.113020 -0.824670  -0.49881 -0.329660 -0.184320 -0.171170 -0.100480
3         NA        NA        NA        NA        NA        NA        NA
4   0.072069  0.202610   0.18078  0.092555  0.025656  0.081237 -0.082777
5   0.004582  0.395130  -0.17714 -0.118190 -0.149810 -0.145800 -0.200430
6         NA -0.167310  -0.28318 -0.080816        NA -0.230490 -0.216150
7  -0.042430 -0.330400  -0.19150 -0.177810 -0.225310 -0.283840 -0.022264
8         NA        NA        NA        NA        NA        NA        NA
9  -0.006795  0.055244   0.07461  0.001002  0.079831  0.103080  0.074083
10  1.048500  0.683890   0.72928  0.794230  1.087200  0.995130  0.986600
   GSM283046 GSM283050 GSM283053 GSM283055 GSM283056 GSM282928 GSM282930
1  -0.448900  -0.78282 -0.243940 -0.504230 -0.179810 -0.200700 -0.259240
2  -0.217010  -0.70640 -0.208020 -0.270910 -0.031842 -0.141710 -0.172890
3         NA        NA        NA        NA        NA        NA        NA
4   0.073801   0.38906  0.055838  0.193920 -0.067809  0.024977  0.025912
5  -0.167480   0.59014 -0.286400 -0.079412 -0.270660 -0.239300 -0.233120
6  -0.242400        NA -0.216330 -0.162770 -0.403920        NA -0.280710
7  -0.046092  -0.10611  0.106800  0.252330 -0.131050  0.157880  0.187540
8         NA        NA        NA        NA        NA        NA        NA
9   0.065097   0.10696  0.051370  0.073447  0.041657  0.033266 -0.047020
10  0.924530   0.64526  0.735550  0.757840  0.906280  0.799970  0.944890
   GSM282932 GSM282934 GSM282976 GSM282979 GSM282998 GSM283013 GSM283017
1  -0.410320 -0.542240 -0.359970  0.371870 -0.050525 -0.734500 -0.532260
2  -0.172910 -0.409370 -0.262980 -0.405500 -0.199390 -0.929930 -0.100540
3         NA        NA        NA        NA        NA        NA        NA
4  -0.123720  0.342070 -0.021517 -0.105510 -0.007270  0.276850  0.043115
5  -0.298050  0.423310 -0.393120 -0.149040 -0.175280  0.616540 -0.208030
6  -0.222310        NA -0.371420 -0.016502 -0.750950 -0.275610 -0.292290
7  -0.050561 -0.011507  0.208020  0.079890  0.177230  0.056996 -0.120000
8         NA        NA        NA        NA        NA        NA        NA
9  -0.009333 -0.010551  0.093018  0.105400 -0.124670  0.212400  0.016247
10  1.260700  0.934850  1.142300  1.373400  0.861660  0.813440  1.157600
   GSM283018 GSM283025 GSM283028 GSM283032 GSM283037 GSM283040 GSM283042
1  -0.225600 -0.049018 -0.153490 -0.411540 -0.251110 -0.307900 -0.705220
2  -0.245960 -0.148050 -0.194460 -0.491460 -0.068553 -0.603640 -0.210220
3         NA        NA        NA        NA        NA        NA        NA
4  -0.058127  0.045410  0.044889  0.086705  0.020100  0.248790  0.084007
5  -0.269840 -0.234690 -0.262200 -0.213540 -0.180520 -0.139480 -0.221190
6         NA        NA -0.258630 -0.063222 -0.154790 -0.121820 -0.210950
7  -0.053724 -0.098554 -0.096136 -0.057379  0.138510 -0.262060 -0.096286
8         NA        NA        NA        NA        NA        NA        NA
9   0.106230 -0.033732  0.028406  0.040278 -0.008371  0.081277  0.085025
10  1.273600  1.068600  1.138600  0.774280  0.897130  0.744600  0.778030
   GSM283045 GSM283048 GSM283052 GSM283054 GSM282980 GSM282982 GSM282984
1  -0.201560 -0.372220  -0.41464 -0.195120 -0.318370 -0.653050 -0.562710
2  -0.232210 -0.115460  -0.27354 -0.094794 -0.299550 -0.278630 -0.208140
3         NA        NA        NA        NA        NA        NA        NA
4   0.007063  0.026871   0.11101 -0.032348  0.090423  0.095394  0.111690
5  -0.061054 -0.100570  -0.27087  0.010375  0.304680 -0.171190 -0.109640
6  -0.195940 -0.228900  -0.22812 -0.063896 -0.125290 -0.261780 -0.066647
7  -0.180220 -0.145640   0.12011  0.156300  0.052526 -0.120210  0.195330
8         NA        NA        NA        NA        NA        NA        NA
9   0.108180  0.119460   0.15976  0.045625  0.160660  0.154090  0.089554
10  1.027900  1.077200   0.83549  0.844130  1.088400  1.184500  0.890920
   GSM282986 GSM282997 GSM283012 GSM283027 GSM283031 GSM283039 GSM283044
1  -0.020951 -0.472260 -0.864530 -0.344810 -0.470160 -0.348040 -0.386640
2  -0.129180 -0.586790 -0.486360 -0.097971 -0.347260 -0.212020 -0.104940
3         NA        NA        NA        NA        NA        NA        NA
4  -0.002692  0.572970  0.368490  0.032596  0.085542  0.088783 -0.025015
5  -0.087794  0.806020  0.591760 -0.307300 -0.211330 -0.169040 -0.286260
6         NA -1.199400 -0.079398 -0.169030 -0.241910        NA -0.189880
7  -0.019239 -0.008787 -0.194860 -0.122250 -0.108950 -0.024565 -0.142520
8         NA        NA        NA        NA        NA        NA        NA
9   0.550530  0.076802  0.208920 -0.013555 -0.005287 -0.010473  0.176750
10  0.766570  0.654210  1.061200  1.241900  0.861930  1.008300  1.220600
   GSM283047
1  -0.295080
2  -0.108720
3         NA
4   0.030573
5  -0.321890
6  -0.162250
7  -0.130970
8         NA
9   0.140480
10  1.142300</code></pre>
</div>
</div>
<p><strong>Save gse11223 &amp; gds3268 objects in _raw/</strong></p>
<p>underlying tables can be extracted from each when they’re loaded as rds files, this ensures collectively of the two pulls when working with the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gds3268, <span class="at">file=</span><span class="fu">file.path</span>(data_dir,<span class="st">"01_load_expression_data.rds"</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gse11223, <span class="at">file=</span><span class="fu">file.path</span> (data_dir,<span class="st">"01_load_meta_data.rds"</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#write_rds(gds3268, file="../_raw/gds3268.rds")</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#write_rds(gse11223, file="../_raw/gse11223.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>_raw/ will indeed only contain raw data pulls (apart from the disturbing list extraction for gse11223…)</p>
<p>Cleaning environment at the end of the file</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="cleaning-data" class="level1">
<h1>Cleaning data</h1>
<section id="loading-libraries-2" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-2">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"stringr"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Clean _raw/ data to data/</p>
<p>Converts each of the following to a tibble dataframe in the tidy format</p>
<ul>
<li><p>the expression GEODataTable from GDS in _raw/</p></li>
<li><p>the metadata from GSE</p>
<ul>
<li><p>phenoData$data - metadata concerning samples (patients)</p></li>
<li><p>featureData$data - metadata concerning genes</p></li>
</ul></li>
</ul>
<p><strong>Setup/Initialization</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">"../data/"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>raw_dir <span class="ot">&lt;-</span> <span class="st">"../data/_raw/"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geodatatable-from-rawraw_expression_data.rds" class="level2">
<h2 class="anchored" data-anchor-id="geodatatable-from-rawraw_expression_data.rds">GEODataTable from raw/raw_expression_data.rds</h2>
<section id="loading-in-the-data" class="level4">
<h4 class="anchored" data-anchor-id="loading-in-the-data">Loading in the data</h4>
<p>Expression data of patients with different genes. (patient) Samples are stored as columns and gene names as rows, which we would like to flip, to align with tidy standards. But first we load the data from _raw/</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Applying the Table function from GEOquery to extract the dataframe.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>exprs_geodf <span class="ot">&lt;-</span> <span class="fu">Table</span>(<span class="fu">read_rds</span>(<span class="fu">file.path</span>(data_dir,<span class="st">"01_load_expression_data.rds"</span>)))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#exprs_geodf &lt;- Table(read_rds("../_raw/gds3268.rds"))</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>exprs_geodf <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(exprs_geodf)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>exprs_geodf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 44,290 × 204
   ID_REF IDENTIFIER GSM282855 GSM282856 GSM282857 GSM282858 GSM282859 GSM282860
    &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1      1 BrightCor…   NA        NA        NA        NA        NA        NA     
 2      2 NegativeC…   NA        NA        NA        NA        NA        NA     
 3      3 A_23_P803…    0.0387   -0.109    -0.0443   -0.0334   -0.0436    0.0268
 4      4 APBA2        -0.133    -0.109    -0.136    -0.119    -0.164    -0.185 
 5      5 MAP3K6       -0.0422    0.0422    0.0180    0.0635    0.0720    0.0587
 6      6 ZNF121       -0.212    -0.240    -0.339    -0.314    -0.436    -0.0504
 7      7 Pro25G       NA        NA        NA        NA        NA        NA     
 8      8 RET          NA        -0.115    -0.442    -0.250    -0.440    -0.467 
 9      9 BX094364      0.0346    0.0149   -0.0541   -0.0582   -0.0832   -0.0951
10     10 C12orf56      0.0286   -0.0422    0.0311   -0.0577   -0.0826   -0.0948
# ℹ 44,280 more rows
# ℹ 196 more variables: GSM282861 &lt;dbl&gt;, GSM282862 &lt;dbl&gt;, GSM282863 &lt;dbl&gt;,
#   GSM282864 &lt;dbl&gt;, GSM282865 &lt;dbl&gt;, GSM282866 &lt;dbl&gt;, GSM282867 &lt;dbl&gt;,
#   GSM282868 &lt;dbl&gt;, GSM282869 &lt;dbl&gt;, GSM282870 &lt;dbl&gt;, GSM282871 &lt;dbl&gt;,
#   GSM282872 &lt;dbl&gt;, GSM282904 &lt;dbl&gt;, GSM282910 &lt;dbl&gt;, GSM282913 &lt;dbl&gt;,
#   GSM282915 &lt;dbl&gt;, GSM282921 &lt;dbl&gt;, GSM282927 &lt;dbl&gt;, GSM282873 &lt;dbl&gt;,
#   GSM282874 &lt;dbl&gt;, GSM282875 &lt;dbl&gt;, GSM282905 &lt;dbl&gt;, GSM282914 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Now we can treat it as a normal dataframe to try to clean it to a tidy dataframe.</p>
</section>
<section id="removing-empty-rows" class="level4">
<h4 class="anchored" data-anchor-id="removing-empty-rows">Removing empty rows</h4>
<p>All 204 columns are (patient) Samples, and of type &lt;dbl&gt; with NA values. With this data we would like to keep the random NA values that appear throughout the dataset as they clearly represent no data. Substituting it with zeros would indicate that there is no expression of that gene in that sample, which is not necessarily the case (most likely not). Although, if an entire row is made of zeros, we would like to exclude that gene.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fully_na <span class="ot">&lt;-</span> exprs_geodf <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">if_all</span>(<span class="fu">starts_with</span>(<span class="st">"GSM"</span>), is.na)) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"ID_REF"</span>) </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">count</span>(fully_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  3299</code></pre>
</div>
</div>
<p>There are 3299 identifiers with completely empty rows in the expression dataset, given in the list “fully_na”. We cannot use the gene column name: “IDENTIFIER”, as it contains duplicates. Lets exclude fully_na indexes from the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>exprs_df <span class="ot">&lt;-</span> exprs_geodf <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(fully_na, <span class="at">by =</span> <span class="st">"ID_REF"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>exprs_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40,991 × 204
   ID_REF IDENTIFIER GSM282855 GSM282856 GSM282857 GSM282858 GSM282859 GSM282860
    &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1      3 A_23_P803…    0.0387   -0.109    -0.0443   -0.0334   -0.0436    0.0268
 2      4 APBA2        -0.133    -0.109    -0.136    -0.119    -0.164    -0.185 
 3      5 MAP3K6       -0.0422    0.0422    0.0180    0.0635    0.0720    0.0587
 4      6 ZNF121       -0.212    -0.240    -0.339    -0.314    -0.436    -0.0504
 5      8 RET          NA        -0.115    -0.442    -0.250    -0.440    -0.467 
 6      9 BX094364      0.0346    0.0149   -0.0541   -0.0582   -0.0832   -0.0951
 7     10 C12orf56      0.0286   -0.0422    0.0311   -0.0577   -0.0826   -0.0948
 8     12 MBD2          0.151     0.211     0.196     0.216     0.235     0.220 
 9     13 LIFR-AS1     -0.268    -0.479    -0.323    -0.343    -0.459    -0.434 
10     15 CMYA5        NA        -0.0329   -0.275     0.0600   -0.341    -0.289 
# ℹ 40,981 more rows
# ℹ 196 more variables: GSM282861 &lt;dbl&gt;, GSM282862 &lt;dbl&gt;, GSM282863 &lt;dbl&gt;,
#   GSM282864 &lt;dbl&gt;, GSM282865 &lt;dbl&gt;, GSM282866 &lt;dbl&gt;, GSM282867 &lt;dbl&gt;,
#   GSM282868 &lt;dbl&gt;, GSM282869 &lt;dbl&gt;, GSM282870 &lt;dbl&gt;, GSM282871 &lt;dbl&gt;,
#   GSM282872 &lt;dbl&gt;, GSM282904 &lt;dbl&gt;, GSM282910 &lt;dbl&gt;, GSM282913 &lt;dbl&gt;,
#   GSM282915 &lt;dbl&gt;, GSM282921 &lt;dbl&gt;, GSM282927 &lt;dbl&gt;, GSM282873 &lt;dbl&gt;,
#   GSM282874 &lt;dbl&gt;, GSM282875 &lt;dbl&gt;, GSM282905 &lt;dbl&gt;, GSM282914 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>With our little sanity check below, we can confirm that 3299 rows has been filtered from the data, matching the number of empty rows (fully_na)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(exprs_geodf)[[<span class="dv">1</span>]] <span class="sc">-</span> <span class="fu">dim</span>(exprs_df)[[<span class="dv">1</span>]] <span class="sc">-</span> <span class="fu">dim</span>(fully_na)[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>We could choose to reset ID_REF values and keep them as the index of the frame (essentially removing them), but that would obscure us from combining the expression dataframe with any potential meta data later on. We therefore instead denote the ID_REF column as lookup keys; since they’re unique.</p>
</section>
<section id="transposing-the-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="transposing-the-dataframe">Transposing the dataframe</h4>
<p>As according to tidy principles, we need variables (gene names) as columns and observations (samples) as rows, which is currently flipped. We therefore need to transpose the dataframe.</p>
<p>We can use pivot_longer to concatenate columns and values except <em>ID_REF</em>, and then pivot_wider to unpack the values along with <em>ID_REF</em>, leaving sample names as row names. Although, currently we have both <em>ID_REF</em> and <em>IDENTIFIER</em> functioning as column headers. We choose to exclude the IDENTIFIER column from the table, and combine it with future metadata tables. As long as the ID_REF is present, we can lookup any meta data there might be for either variables and observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>identifier_exprs <span class="ot">&lt;-</span> exprs_df <span class="sc">|&gt;</span>  <span class="co"># for later use</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID_REF, IDENTIFIER)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>exprs_df <span class="ot">&lt;-</span> exprs_df <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>IDENTIFIER) <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Packing column names to one (except ID_REF)</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>ID_REF,          </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"geo_accession"</span>, </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span>  </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Unpacking ID_REF as columns</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> ID_REF,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> Value</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>exprs_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 202 × 40,992
   geo_accession      `3`     `4`     `5`     `6`     `8`     `9`    `10`  `12`
   &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 GSM282855      0.0387  -0.133  -0.0422 -0.212  NA       0.0346  0.0286 0.151
 2 GSM282856     -0.109   -0.109   0.0422 -0.240  -0.115   0.0149 -0.0422 0.211
 3 GSM282857     -0.0443  -0.136   0.0180 -0.339  -0.442  -0.0541  0.0311 0.196
 4 GSM282858     -0.0334  -0.119   0.0635 -0.314  -0.250  -0.0582 -0.0577 0.216
 5 GSM282859     -0.0436  -0.164   0.0720 -0.436  -0.440  -0.0832 -0.0826 0.235
 6 GSM282860      0.0268  -0.185   0.0587 -0.0504 -0.467  -0.0951 -0.0948 0.220
 7 GSM282861     -0.0448  -0.0768  0.292  -0.318  -0.141   0.0369  0.0377 0.190
 8 GSM282862     -0.0588  -0.184   0.101  -0.286  -0.113  -0.0992 -0.0966 0.275
 9 GSM282863     -0.0428  -0.108   0.125  -0.0161 -0.430   0.0272 -0.0273 0.281
10 GSM282864     -0.00537 -0.186   0.143  -0.274  -0.0461  0.0356  0.0444 0.108
# ℹ 192 more rows
# ℹ 40,983 more variables: `13` &lt;dbl&gt;, `15` &lt;dbl&gt;, `16` &lt;dbl&gt;, `17` &lt;dbl&gt;,
#   `18` &lt;dbl&gt;, `19` &lt;dbl&gt;, `22` &lt;dbl&gt;, `24` &lt;dbl&gt;, `25` &lt;dbl&gt;, `26` &lt;dbl&gt;,
#   `27` &lt;dbl&gt;, `29` &lt;dbl&gt;, `30` &lt;dbl&gt;, `31` &lt;dbl&gt;, `32` &lt;dbl&gt;, `33` &lt;dbl&gt;,
#   `34` &lt;dbl&gt;, `36` &lt;dbl&gt;, `37` &lt;dbl&gt;, `38` &lt;dbl&gt;, `39` &lt;dbl&gt;, `40` &lt;dbl&gt;,
#   `41` &lt;dbl&gt;, `43` &lt;dbl&gt;, `45` &lt;dbl&gt;, `46` &lt;dbl&gt;, `47` &lt;dbl&gt;, `48` &lt;dbl&gt;,
#   `50` &lt;dbl&gt;, `51` &lt;dbl&gt;, `52` &lt;dbl&gt;, `53` &lt;dbl&gt;, `54` &lt;dbl&gt;, `55` &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Now we see the data transposed with 202 rows and 40,992 columns, as opposed to the opposite before.</p>
</section>
</section>
<section id="removing-low-variance-genes" class="level2">
<h2 class="anchored" data-anchor-id="removing-low-variance-genes">Removing low variance genes</h2>
<p>To lighten the load on the server we also removed low variance genes, also if there is little to no variance the genes are probably not important.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>gene_var <span class="ot">&lt;-</span> exprs_df <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop the sample ID column, keep only expression values</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>geo_accession) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">var</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">everything</span>(),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="st">"gene"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"variance"</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gene_var, <span class="fu">aes</span>(<span class="at">x =</span> variance)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-30-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"variance_distribution_across_genes.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
</div>
<p>We decide to cutoff genes with a variance below 0.05, and have 2909 genes remaining</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>genes_keep <span class="ot">&lt;-</span> gene_var <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variance <span class="sc">&gt;</span> <span class="fl">0.05</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(gene)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>exprs_filtered <span class="ot">&lt;-</span> exprs_df <span class="sc">|&gt;</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_accession, <span class="fu">all_of</span>(genes_keep))</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(genes_keep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2909</code></pre>
</div>
</div>
</section>
<section id="phenodatadata-from-_rawgse11223.rds" class="level2">
<h2 class="anchored" data-anchor-id="phenodatadata-from-_rawgse11223.rds">phenoData$data from _raw/gse11223.rds</h2>
<p>Metadata concerning samples (patients), extracting the nested data frame phenodata, while removing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>gse11223 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="at">file =</span> <span class="fu">file.path</span>(data_dir,<span class="st">"01_load_meta_data.rds"</span>)) </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>phenodata <span class="ot">&lt;-</span> <span class="fu">pData</span>(<span class="fu">phenoData</span>(gse11223[<span class="dv">1</span>]))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>phenodata <span class="sc">|&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">n_distinct</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>(),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"col"</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"n_levels"</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_levels <span class="sc">&lt;=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 2
   col                  n_levels
   &lt;chr&gt;                   &lt;int&gt;
 1 status                      1
 2 submission_date             1
 3 last_update_date            1
 4 type                        1
 5 channel_count               1
 6 organism_ch1                1
 7 molecule_ch1                1
 8 extract_protocol_ch1        1
 9 label_ch1                   1
10 label_protocol_ch1          1
# ℹ 24 more rows</code></pre>
</div>
</div>
<p>Once we spotted the “one type columns” we drop them. Then we check the remaining ones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>phenodata <span class="ot">&lt;-</span> phenodata <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">n_distinct</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">1</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(phenodata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "title"                         "geo_accession"                
  [3] "source_name_ch1"               "characteristics_ch1"          
  [5] "characteristics_ch1.1"         "characteristics_ch1.2"        
  [7] "characteristics_ch1.3"         "characteristics_ch1.4"        
  [9] "characteristics_ch1.5"         "characteristics_ch1.6"        
 [11] "characteristics_ch1.7"         "characteristics_ch1.8"        
 [13] "characteristics_ch1.9"         "characteristics_ch1.10"       
 [15] "characteristics_ch1.11"        "characteristics_ch1.12"       
 [17] "characteristics_ch1.13"        "characteristics_ch1.14"       
 [19] "characteristics_ch1.15"        "characteristics_ch1.16"       
 [21] "characteristics_ch1.17"        "characteristics_ch1.18"       
 [23] "characteristics_ch1.19"        "characteristics_ch1.20"       
 [25] "characteristics_ch1.21"        "characteristics_ch1.22"       
 [27] "characteristics_ch1.23"        "characteristics_ch1.24"       
 [29] "characteristics_ch1.25"        "characteristics_ch1.26"       
 [31] "characteristics_ch1.27"        "characteristics_ch1.28"       
 [33] "characteristics_ch1.29"        "characteristics_ch1.30"       
 [35] "characteristics_ch1.31"        "characteristics_ch1.32"       
 [37] "characteristics_ch1.33"        "characteristics_ch1.34"       
 [39] "characteristics_ch1.35"        "characteristics_ch1.36"       
 [41] "characteristics_ch1.37"        "characteristics_ch1.38"       
 [43] "characteristics_ch1.39"        "characteristics_ch1.40"       
 [45] "characteristics_ch1.41"        "characteristics_ch1.42"       
 [47] "characteristics_ch1.43"        "characteristics_ch1.44"       
 [49] "characteristics_ch1.45"        "characteristics_ch1.46"       
 [51] "characteristics_ch1.47"        "characteristics_ch1.48"       
 [53] "characteristics_ch1.49"        "characteristics_ch1.50"       
 [55] "characteristics_ch1.51"        "characteristics_ch1.52"       
 [57] "characteristics_ch1.53"        "characteristics_ch1.54"       
 [59] "description"                   "supplementary_file"           
 [61] "relation"                      "relation.1"                   
 [63] "albumin:ch1"                   "anatomic_location:ch1"        
 [65] "aza at present:ch1"            "aza tolerant:ch1"             
 [67] "aza treated:ch1"               "birth date:ch1"               
 [69] "blood obtained:ch1"            "calprotectin:ch1"             
 [71] "casenote review date:ch1"      "category:ch1"                 
 [73] "crp:ch1"                       "current medication:ch1"       
 [75] "diagnosis date:ch1"            "diagnosis hep flex:ch1"       
 [77] "diagnosis recto sigmoid:ch1"   "diagnosis rectum:ch1"         
 [79] "diagnosis splen flex:ch1"      "diagnosis total:ch1"          
 [81] "disease:ch1"                   "dlg5 133a:ch1"                
 [83] "esr:ch1"                       "ethnicity:ch1"                
 [85] "family history:ch1"            "followup hep flex:ch1"        
 [87] "followup recto sigmoid:ch1"    "followup rectum:ch1"          
 [89] "followup splen flex:ch1"       "followup total:ch1"           
 [91] "hb:ch1"                        "ibd affected relatives:ch1"   
 [93] "igr2096:ch1"                   "igr2198:ch1"                  
 [95] "igr2230:ch1"                   "indictation for procedure:ch1"
 [97] "inflammation_status:ch1"       "joint problems:ch1"           
 [99] "last followup date:ch1"        "neutrophils:ch1"              
[101] "nod 1007 fs:ch1"               "nod 702:ch1"                  
[103] "nod 908:ch1"                   "octn1:ch1"                    
[105] "octn2:ch1"                     "other illnesses:ch1"          
[107] "patient:ch1"                   "procedure date:ch1"           
[109] "run_date:ch1"                  "smoking amount:ch1"           
[111] "smoking start date:ch1"        "smoking status:ch1"           
[113] "smoking stop date:ch1"         "symptoms onset date:ch1"      
[115] "uc flare up:ch1"               "ucss:ch1"                     
[117] "wcc:ch1"                      </code></pre>
</div>
</div>
<p>Then we remove the duplicate columns and rename them appropriately</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>phenodata <span class="ot">&lt;-</span> phenodata <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Convert all columns with "characteristics_ch1" to long format</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"characteristics_ch1"</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"old_col"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Split</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">col  =</span> value,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"prefix"</span>, <span class="st">"content"</span>),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep  =</span> <span class="st">":"</span>,  <span class="co"># split at the first colon</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"right"</span>,   <span class="co"># if content is missing, fill with NA</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Clean the prefix</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">prefix =</span> <span class="fu">str_replace_all</span>(prefix, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">"_"</span>),</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">content =</span> <span class="fu">str_trim</span>(content)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>old_col) <span class="sc">|&gt;</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Convert back to wide</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> prefix,</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> content</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>phenodata <span class="ot">&lt;-</span> phenodata <span class="sc">|&gt;</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">ends_with</span>(<span class="st">":ch1"</span>),</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ends_with</span>(<span class="st">":ch1"</span>)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(phenodata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "title"                         "geo_accession"                
  [3] "source_name_ch1"               "description"                  
  [5] "supplementary_file"            "relation"                     
  [7] "relation.1"                    "patient"                      
  [9] "current_medication"            "birth_date"                   
 [11] "ethnicity"                     "symptoms_onset_date"          
 [13] "diagnosis_date"                "joint_problems"               
 [15] "uc_flare_up"                   "family_history"               
 [17] "aza_treated"                   "aza_tolerant"                 
 [19] "aza_at_present"                "procedure_date"               
 [21] "indictation_for_procedure"     "ucss"                         
 [23] "calprotectin"                  "esr"                          
 [25] "crp"                           "hb"                           
 [27] "wcc"                           "neutrophils"                  
 [29] "albumin"                       "blood_obtained"               
 [31] "ibd_affected_relatives"        "igr2096"                      
 [33] "igr2198"                       "igr2230"                      
 [35] "octn1"                         "octn2"                        
 [37] "nod_702"                       "nod_908"                      
 [39] "dlg5_133a"                     "nod_1007_fs"                  
 [41] "diagnosis_rectum"              "diagnosis_recto_sigmoid"      
 [43] "diagnosis_splen_flex"          "diagnosis_hep_flex"           
 [45] "diagnosis_total"               "last_followup_date"           
 [47] "followup_rectum"               "followup_recto_sigmoid"       
 [49] "followup_splen_flex"           "followup_hep_flex"            
 [51] "followup_total"                "casenote_review_date"         
 [53] "category"                      "smoking_status"               
 [55] "smoking_start_date"            "smoking_stop_date"            
 [57] "smoking_amount"                "other_illnesses"              
 [59] "disease"                       "run_date"                     
 [61] "anatomic_location"             "inflammation_status"          
 [63] "albumin:ch1"                   "anatomic_location:ch1"        
 [65] "aza at present:ch1"            "aza tolerant:ch1"             
 [67] "aza treated:ch1"               "birth date:ch1"               
 [69] "blood obtained:ch1"            "calprotectin:ch1"             
 [71] "casenote review date:ch1"      "category:ch1"                 
 [73] "crp:ch1"                       "current medication:ch1"       
 [75] "diagnosis date:ch1"            "diagnosis hep flex:ch1"       
 [77] "diagnosis recto sigmoid:ch1"   "diagnosis rectum:ch1"         
 [79] "diagnosis splen flex:ch1"      "diagnosis total:ch1"          
 [81] "disease:ch1"                   "dlg5 133a:ch1"                
 [83] "esr:ch1"                       "ethnicity:ch1"                
 [85] "family history:ch1"            "followup hep flex:ch1"        
 [87] "followup recto sigmoid:ch1"    "followup rectum:ch1"          
 [89] "followup splen flex:ch1"       "followup total:ch1"           
 [91] "hb:ch1"                        "ibd affected relatives:ch1"   
 [93] "igr2096:ch1"                   "igr2198:ch1"                  
 [95] "igr2230:ch1"                   "indictation for procedure:ch1"
 [97] "inflammation_status:ch1"       "joint problems:ch1"           
 [99] "last followup date:ch1"        "neutrophils:ch1"              
[101] "nod 1007 fs:ch1"               "nod 702:ch1"                  
[103] "nod 908:ch1"                   "octn1:ch1"                    
[105] "octn2:ch1"                     "other illnesses:ch1"          
[107] "patient:ch1"                   "procedure date:ch1"           
[109] "run_date:ch1"                  "smoking amount:ch1"           
[111] "smoking start date:ch1"        "smoking status:ch1"           
[113] "smoking stop date:ch1"         "symptoms onset date:ch1"      
[115] "uc flare up:ch1"               "ucss:ch1"                     
[117] "wcc:ch1"                      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>phenodata <span class="ot">&lt;-</span> phenodata[, <span class="sc">!</span><span class="fu">duplicated</span>(<span class="fu">as.list</span>(phenodata))]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(phenodata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "title"                     "geo_accession"            
 [3] "source_name_ch1"           "supplementary_file"       
 [5] "relation"                  "patient"                  
 [7] "current_medication"        "birth_date"               
 [9] "ethnicity"                 "symptoms_onset_date"      
[11] "diagnosis_date"            "joint_problems"           
[13] "uc_flare_up"               "family_history"           
[15] "aza_treated"               "aza_tolerant"             
[17] "aza_at_present"            "procedure_date"           
[19] "indictation_for_procedure" "ucss"                     
[21] "calprotectin"              "esr"                      
[23] "crp"                       "hb"                       
[25] "wcc"                       "neutrophils"              
[27] "albumin"                   "blood_obtained"           
[29] "ibd_affected_relatives"    "igr2096"                  
[31] "igr2198"                   "igr2230"                  
[33] "octn1"                     "octn2"                    
[35] "nod_702"                   "nod_908"                  
[37] "nod_1007_fs"               "diagnosis_rectum"         
[39] "diagnosis_recto_sigmoid"   "diagnosis_splen_flex"     
[41] "diagnosis_hep_flex"        "diagnosis_total"          
[43] "last_followup_date"        "followup_rectum"          
[45] "followup_recto_sigmoid"    "followup_splen_flex"      
[47] "followup_hep_flex"         "followup_total"           
[49] "casenote_review_date"      "category"                 
[51] "smoking_status"            "smoking_start_date"       
[53] "smoking_stop_date"         "smoking_amount"           
[55] "other_illnesses"           "disease"                  
[57] "run_date"                  "anatomic_location"        
[59] "inflammation_status"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>phenodata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 202 × 59
   title       geo_accession source_name_ch1 supplementary_file relation patient
   &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;  
 1 5192 Norma… GSM282855     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 101    
 2 5193 Norma… GSM282856     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 102    
 3 5194 Norma… GSM282857     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 103    
 4 5195 Norma… GSM282858     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 105    
 5 5196 Norma… GSM282859     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 105    
 6 5197 Norma… GSM282860     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 106    
 7 5198 Norma… GSM282861     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 108    
 8 5199 Norma… GSM282862     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 104    
 9 5200 Norma… GSM282863     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 107    
10 5201 Norma… GSM282864     Normal Uninfla… ftp://ftp.ncbi.nl… Reanaly… 109    
# ℹ 192 more rows
# ℹ 53 more variables: current_medication &lt;chr&gt;, birth_date &lt;chr&gt;,
#   ethnicity &lt;chr&gt;, symptoms_onset_date &lt;chr&gt;, diagnosis_date &lt;chr&gt;,
#   joint_problems &lt;chr&gt;, uc_flare_up &lt;chr&gt;, family_history &lt;chr&gt;,
#   aza_treated &lt;chr&gt;, aza_tolerant &lt;chr&gt;, aza_at_present &lt;chr&gt;,
#   procedure_date &lt;chr&gt;, indictation_for_procedure &lt;chr&gt;, ucss &lt;chr&gt;,
#   calprotectin &lt;chr&gt;, esr &lt;chr&gt;, crp &lt;chr&gt;, hb &lt;chr&gt;, wcc &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>The phenodata has been extracted from the gse11223 and now we will pick and choose the data that is, perhaps removing those variables that are of no importance for us, such as status, submission_date, type, channel_count, organism_ch1 (as they are all homo sapiens) and characteristics_ch1</p>
</section>
<section id="selecting-variables" class="level2">
<h2 class="anchored" data-anchor-id="selecting-variables">Selecting variables</h2>
<p>Selecting which variables from phenodata that we would like to keep for further analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>phenodata <span class="ot">&lt;-</span> phenodata <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_accession, patient, current_medication, birth_date, ethnicity, symptoms_onset_date, diagnosis_date, joint_problems, uc_flare_up, family_history, neutrophils, albumin, ibd_affected_relatives, smoking_status, smoking_start_date, smoking_stop_date, smoking_amount, other_illnesses, disease, anatomic_location, inflammation_status, procedure_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merging-phenodata" class="level2">
<h2 class="anchored" data-anchor-id="merging-phenodata">Merging phenodata</h2>
<p>Do a left_join() with phenodata and exprs_df on geo_accession</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="ot">&lt;-</span> <span class="fu">right_join</span>(phenodata, exprs_filtered, <span class="at">by =</span> <span class="st">"geo_accession"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Stretching the data set so that genes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="ot">&lt;-</span>  finaldata <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">23</span><span class="sc">:</span><span class="fu">last_col</span>(),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"gene_id"</span> ,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"gene_expr"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="featuredatadata-from-_rawgse11223.rds" class="level2">
<h2 class="anchored" data-anchor-id="featuredatadata-from-_rawgse11223.rds">featureData$data from _raw/gse11223.rds</h2>
<p>Metadata concerning genes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>featuredata <span class="ot">&lt;-</span> <span class="fu">pData</span>(<span class="fu">featureData</span>(gse11223))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we filter the same low variance genes from featuredata using the gene ID in genes_keep</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>featuredata <span class="ot">&lt;-</span> featuredata <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> genes_keep)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exporting-to-data" class="level2">
<h2 class="anchored" data-anchor-id="exporting-to-data">Exporting to data/</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(finaldata, <span class="at">file =</span> <span class="st">"../data/02_dat_clean.csv.gz"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(featuredata, <span class="at">file =</span> <span class="st">"../data/02_dat_genbank.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-environment" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-environment">Cleaning environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="augmenting" class="level1">
<h1>Augmenting</h1>
<section id="loading-libraries-3" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-3">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggrepel"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-finaldata-and-featuredata" class="level2">
<h2 class="anchored" data-anchor-id="loading-finaldata-and-featuredata">Loading finaldata and featuredata</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/02_dat_clean.csv.gz"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>featuredata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/02_dat_genbank.csv.gz"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(finaldata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "geo_accession"          "patient"                "current_medication"    
 [4] "birth_date"             "ethnicity"              "symptoms_onset_date"   
 [7] "diagnosis_date"         "joint_problems"         "uc_flare_up"           
[10] "family_history"         "neutrophils"            "albumin"               
[13] "ibd_affected_relatives" "smoking_status"         "smoking_start_date"    
[16] "smoking_stop_date"      "smoking_amount"         "other_illnesses"       
[19] "disease"                "anatomic_location"      "inflammation_status"   
[22] "procedure_date"         "gene_id"                "gene_expr"             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(featuredata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ID"                   "COL"                  "ROW"                 
 [4] "NAME"                 "SPOT_ID"              "CONTROL_TYPE"        
 [7] "REFSEQ"               "GB_ACC"               "GENE"                
[10] "GENE_SYMBOL"          "GENE_NAME"            "UNIGENE_ID"          
[13] "ENSEMBL_ID"           "TIGR_ID"              "ACCESSION_STRING"    
[16] "CHROMOSOMAL_LOCATION" "CYTOBAND"             "DESCRIPTION"         
[19] "GO_ID"                "SEQUENCE"            </code></pre>
</div>
</div>
</section>
<section id="calculating-the-age-from-date-of-birth" class="level2">
<h2 class="anchored" data-anchor-id="calculating-the-age-from-date-of-birth">Calculating the Age from date of birth</h2>
<p>Birth date reformat - input a date in string format, with “/” as spacer. Date format should be in MM/DD/YY</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="at">file =</span> <span class="st">"99_proj_func.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Making the age variable from the date of birth and the submission date for the article, to estimate the age. at the time of sampling. We identified some birth dates that were written as MM/DD/1060, we belive it is a typo and what was meant was 1960. Hence we changed it to 1960.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">birth_date =</span> <span class="fu">reformat_dates</span>(birth_date)) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">procedure_date =</span> <span class="fu">as.Date</span>(procedure_date, <span class="st">"%m/%d/%y"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">difftime</span>(procedure_date, birth_date, <span class="at">units =</span> <span class="st">"days"</span>)) <span class="sc">/</span> <span class="fl">365.25</span>, <span class="dv">0</span>), <span class="at">.after=</span>procedure_date) <span class="sc">|&gt;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">20</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"(20,30]"</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">30</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"(30,40]"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">40</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="st">"(40,50]"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">50</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">"(50,60]"</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">60</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"(60,70]"</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">70</span> <span class="sc">&lt;=</span> age <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"(70,80]"</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">.after=</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reformatting-symptoms_onset_date-diagnosis_date-calculating-the-time-difference-from-symptoms_onset-to-diagnosis_date" class="level2">
<h2 class="anchored" data-anchor-id="reformatting-symptoms_onset_date-diagnosis_date-calculating-the-time-difference-from-symptoms_onset-to-diagnosis_date">Reformatting symptoms_onset_date &amp; diagnosis_date &amp; Calculating the time difference from symptoms_onset to diagnosis_date</h2>
<p>Will reflect time between time of diagnosis and treatment. Shorter time from first symptom to treatment may slow the disease development.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">symptoms_onset_date =</span> <span class="fu">as.Date</span>(symptoms_onset_date, <span class="st">"%m/%d/%y"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diagnosis_date =</span> <span class="fu">as.Date.character</span>(diagnosis_date, <span class="st">"%m/%d/%y"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_untreated =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(diagnosis_date, symptoms_onset_date, <span class="at">units =</span> <span class="st">"days"</span>)), <span class="at">.after =</span> diagnosis_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparation-for-volcano-plot" class="level2">
<h2 class="anchored" data-anchor-id="preparation-for-volcano-plot">Preparation for volcano plot</h2>
<p>First we remove the NA from both gene_expr and inflammation_status as if we try to do a t-test without removing these NAs it would not work. We are this is only for use in the vulcano plot as it might skew the other analysis. An <code>mutate()</code> <code>inflammation_status</code> in order to create binary factors for the t-test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>final_clean <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gene_expr),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(inflammation_status)) <span class="sc">|&gt;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflammation_status =</span> <span class="fu">factor</span>(inflammation_status,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Uninflamed"</span>, <span class="st">"Inflamed"</span>)) <span class="co"># control first</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we get group the data by Gene id. We take the mean of gene expression for both the inflammed group and the uninflammed group. We used tryCatch to make sure the code is run and returns NA if the it fails. We save the significant p-values and negative log 10 p- value.</p>
<p>The t-test significance are done with a 95% confidence interval hence any values outside of the 95 % confidence interval would be considered significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>de_results <span class="ot">&lt;-</span> final_clean <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gene_id) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep only genes with both groups present</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(inflammation_status) <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_inflamed   =</span> <span class="fu">mean</span>(gene_expr[inflammation_status <span class="sc">==</span> <span class="st">"Inflamed"</span>],   <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_uninflamed =</span> <span class="fu">mean</span>(gene_expr[inflammation_status <span class="sc">==</span> <span class="st">"Uninflamed"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate fold change and p values</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">log2FC =</span> mean_inflamed <span class="sc">-</span> mean_uninflamed,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t.test</span>(gene_expr <span class="sc">~</span> inflammation_status)<span class="sc">$</span>p.value,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">neg_log10_p =</span> <span class="sc">-</span><span class="fu">log10</span>(p_value),</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig =</span> p_value <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparation-for-random-forest-model" class="level2">
<h2 class="anchored" data-anchor-id="preparation-for-random-forest-model">Preparation for Random Forest model</h2>
<p>Reformatting expression dataframe with classifier (y_value) ready for a Random Forest Classifier model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>disease_geo <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_accession, disease) <span class="sc">|&gt;</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(geo_accession, disease)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>expr_df <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span> </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_accession, gene_id, gene_expr) <span class="sc">|&gt;</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(gene_expr)) <span class="sc">|&gt;</span> </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gene_id,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> gene_expr) <span class="sc">|&gt;</span> </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">"Gene_"</span>, .), </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(geo_accession)) <span class="sc">|&gt;</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Gene_"</span>), <span class="sc">~</span><span class="fu">replace_na</span>(., <span class="dv">0</span>))) <span class="sc">|&gt;</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(geo_accession, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(disease_geo, <span class="at">by =</span> <span class="st">"geo_accession"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_pred_UC =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(disease <span class="sc">==</span> <span class="st">"Normal"</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>                               disease <span class="sc">==</span> <span class="st">"UC"</span> <span class="sc">~</span> <span class="dv">1</span>)),</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">.keep =</span> <span class="st">"unused"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exporting-to-data-1" class="level2">
<h2 class="anchored" data-anchor-id="exporting-to-data-1">Exporting to data/</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(finaldata, <span class="at">file =</span> <span class="st">"../data/03_dat_aug.csv.gz"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(featuredata, <span class="at">file =</span> <span class="st">"../data/03_dat_genbank.csv.gz"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(de_results, <span class="at">file =</span> <span class="st">"../data/03_de_results.csv.gz"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(expr_df, <span class="at">file =</span> <span class="st">"../data/03_rf_expr_df.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-environment-1" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-environment-1">Cleaning environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="describing" class="level1">
<h1>Describing</h1>
<section id="loading-libraries-4" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-4">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"table1"</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-finaldata-and-featuredata-1" class="level2">
<h2 class="anchored" data-anchor-id="loading-finaldata-and-featuredata-1">Loading finaldata and featuredata</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>finaldata   <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_dat_aug.csv.gz"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>featuredata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/featuredata.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finaldata" class="level2">
<h2 class="anchored" data-anchor-id="finaldata">Finaldata:</h2>
<p>Here we select all the the meta data to make a table, so we get an entry for each patient, in order to see their smoking habits, ethnicity, blood status and more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fin_all<span class="ot">&lt;-</span>finaldata<span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    patient,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    ethnicity,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    joint_problems,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    uc_flare_up,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    family_history,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    neutrophils,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    albumin,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    ibd_affected_relatives,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    smoking_status,</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    smoking_amount,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    other_illnesses,</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    disease,</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    anatomic_location,</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    inflammation_status,</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    age,</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    age_group</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(patient,<span class="at">.keep_all=</span><span class="cn">TRUE</span>)<span class="sc">|&gt;</span>  <span class="co"># Keep one record per patient (remove duplicates if multiple biopsies exist)</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">neutrophils=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(neutrophils)),      <span class="co"># Convert to numeric; non-numeric values become NA</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">albumin=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(albumin)),</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoking_amount=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(smoking_amount)),<span class="co"># Smoking amount as numeric</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">age=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(age)),                      <span class="co"># Age converted to numeric</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fattori</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ethnicity=</span><span class="fu">factor</span>(ethnicity),                                <span class="co"># Convert categorical variables to factors</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">joint_problems=</span><span class="fu">factor</span>(joint_problems),</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">uc_flare_up=</span><span class="fu">factor</span>(uc_flare_up),</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">family_history=</span><span class="fu">factor</span>(family_history),</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">ibd_affected_relatives=</span><span class="fu">factor</span>(ibd_affected_relatives),</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoking_status=</span><span class="fu">factor</span>(smoking_status),</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">disease=</span><span class="fu">factor</span>(disease),</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">anatomic_location=</span><span class="fu">factor</span>(anatomic_location),</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflammation_status=</span><span class="fu">factor</span>(inflammation_status),</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group=</span><span class="fu">factor</span>(age_group)</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>fin_all<span class="sc">$</span>neutrophils[fin_all<span class="sc">$</span>neutrophils<span class="sc">==</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span>   <span class="co"># Replace 0 with NA</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>fin_all<span class="sc">$</span>albumin[fin_all<span class="sc">$</span>albumin<span class="sc">==</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>fin_all<span class="sc">$</span>other_illnesses_clean<span class="ot">&lt;-</span>dplyr<span class="sc">::</span><span class="fu">case_when</span>(   <span class="co"># Clean comorbidity field into a simple binary variable</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>(fin_all<span class="sc">$</span>other_illnesses)<span class="sc">~</span><span class="cn">NA_character_</span>,</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>  fin_all<span class="sc">$</span>other_illnesses<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"none"</span>,<span class="st">"None"</span>,<span class="st">"NONE"</span>)<span class="sc">~</span><span class="st">"None"</span>,</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span><span class="sc">~</span><span class="st">"Any comorbidity"</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>fin_all<span class="sc">$</span>other_illnesses_clean<span class="ot">&lt;-</span><span class="fu">factor</span>(             <span class="co"># Convert cleaned comorbidity variable to factor</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>  fin_all<span class="sc">$</span>other_illnesses_clean,</span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"None"</span>,<span class="st">"Any comorbidity"</span>)</span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>neutrophils)<span class="ot">&lt;-</span><span class="st">"Neutrophils"</span>                  <span class="co"># Labels for table1() formatting</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>albumin)<span class="ot">&lt;-</span><span class="st">"Albumin"</span></span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>ethnicity)<span class="ot">&lt;-</span><span class="st">"Ethnicity"</span></span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>joint_problems)<span class="ot">&lt;-</span><span class="st">"Joint problems"</span></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>uc_flare_up)<span class="ot">&lt;-</span><span class="st">"UC flare-up"</span></span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>family_history)<span class="ot">&lt;-</span><span class="st">"Family history of IBD"</span></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>ibd_affected_relatives)<span class="ot">&lt;-</span><span class="st">"IBD-affected relatives"</span></span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>smoking_status)<span class="ot">&lt;-</span><span class="st">"Smoking status"</span></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>other_illnesses_clean)<span class="ot">&lt;-</span><span class="st">"Other illnesses"</span></span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>disease)<span class="ot">&lt;-</span><span class="st">"Disease group"</span></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>anatomic_location)<span class="ot">&lt;-</span><span class="st">"Anatomic location"</span></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>inflammation_status)<span class="ot">&lt;-</span><span class="st">"Inflammation status"</span></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>age)<span class="ot">&lt;-</span><span class="st">"Age"</span></span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(fin_all<span class="sc">$</span>age_group)<span class="ot">&lt;-</span><span class="st">"Age group"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we create a table of the data using the <code>table1</code> package using the variables shown in the code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table1</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> age <span class="sc">+</span> neutrophils <span class="sc">+</span> albumin <span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    ethnicity <span class="sc">+</span> smoking_status <span class="sc">+</span> other_illnesses_clean <span class="sc">+</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    anatomic_location <span class="sc">+</span> inflammation_status <span class="sc">+</span> joint_problems <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    family_history <span class="sc">+</span> ibd_affected_relatives <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    age_group</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span> disease,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fin_all</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="Rtable1">
<table class="Rtable1 caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Normal<br>
<span class="stratn">(N=30)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">UC<br>
<span class="stratn">(N=63)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Overall<br>
<span class="stratn">(N=93)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">Age</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>41.3 (16.3)</td>
<td>50.9 (15.9)</td>
<td>47.8 (16.6)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">41.5 [17.0, 76.0]</td>
<td class="lastrow">50.0 [19.0, 84.0]</td>
<td class="lastrow">47.0 [17.0, 84.0]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Neutrophils</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>NA (NA)</td>
<td>7.00 (6.06)</td>
<td>7.00 (6.06)</td>
</tr>
<tr class="even">
<td class="rowlabel">Median [Min, Max]</td>
<td>NA [NA, NA]</td>
<td>4.50 [3.00, 16.0]</td>
<td>4.50 [3.00, 16.0]</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">30 (100%)</td>
<td class="lastrow">59 (93.7%)</td>
<td class="lastrow">89 (95.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Albumin</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>NA (NA)</td>
<td>35.0 (10.6)</td>
<td>35.0 (10.6)</td>
</tr>
<tr class="even">
<td class="rowlabel">Median [Min, Max]</td>
<td>NA [NA, NA]</td>
<td>39.0 [23.0, 43.0]</td>
<td>39.0 [23.0, 43.0]</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">30 (100%)</td>
<td class="lastrow">60 (95.2%)</td>
<td class="lastrow">90 (96.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Ethnicity</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">ASIAN</td>
<td>0 (0%)</td>
<td>3 (4.8%)</td>
<td>3 (3.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel">CAUCASIAN</td>
<td>24 (80.0%)</td>
<td>60 (95.2%)</td>
<td>84 (90.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">JEWISH</td>
<td class="lastrow">6 (20.0%)</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">6 (6.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Smoking status</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">current</td>
<td>0 (0%)</td>
<td>6 (9.5%)</td>
<td>6 (6.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel">ex</td>
<td>0 (0%)</td>
<td>22 (34.9%)</td>
<td>22 (23.7%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">never</td>
<td>0 (0%)</td>
<td>33 (52.4%)</td>
<td>33 (35.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel">unknown</td>
<td>0 (0%)</td>
<td>2 (3.2%)</td>
<td>2 (2.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">30 (100%)</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">30 (32.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Other illnesses</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">None</td>
<td>0 (0%)</td>
<td>38 (60.3%)</td>
<td>38 (40.9%)</td>
</tr>
<tr class="even">
<td class="rowlabel">Any comorbidity</td>
<td>0 (0%)</td>
<td>25 (39.7%)</td>
<td>25 (26.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">30 (100%)</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">30 (32.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Anatomic location</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">ascending colon</td>
<td>4 (13.3%)</td>
<td>12 (19.0%)</td>
<td>16 (17.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel">descending colon</td>
<td>3 (10.0%)</td>
<td>10 (15.9%)</td>
<td>13 (14.0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">sigmoid colon</td>
<td>20 (66.7%)</td>
<td>38 (60.3%)</td>
<td>58 (62.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">terminal ileum</td>
<td class="lastrow">3 (10.0%)</td>
<td class="lastrow">3 (4.8%)</td>
<td class="lastrow">6 (6.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Inflammation status</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Inflamed</td>
<td>3 (10.0%)</td>
<td>34 (54.0%)</td>
<td>37 (39.8%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Uninflamed</td>
<td class="lastrow">27 (90.0%)</td>
<td class="lastrow">29 (46.0%)</td>
<td class="lastrow">56 (60.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Joint problems</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">FALSE</td>
<td>30 (100%)</td>
<td>62 (98.4%)</td>
<td>92 (98.9%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">TRUE</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">1 (1.6%)</td>
<td class="lastrow">1 (1.1%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Family history of IBD</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">FALSE</td>
<td>30 (100%)</td>
<td>57 (90.5%)</td>
<td>87 (93.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">TRUE</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">6 (9.5%)</td>
<td class="lastrow">6 (6.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">IBD-affected relatives</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">0</td>
<td>0 (0%)</td>
<td>59 (93.7%)</td>
<td>59 (63.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel">1</td>
<td>0 (0%)</td>
<td>2 (3.2%)</td>
<td>2 (2.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">2</td>
<td>0 (0%)</td>
<td>2 (3.2%)</td>
<td>2 (2.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">30 (100%)</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">30 (32.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Age group</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">(20,30]</td>
<td>7 (23.3%)</td>
<td>7 (11.1%)</td>
<td>14 (15.1%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">(30,40]</td>
<td>4 (13.3%)</td>
<td>4 (6.3%)</td>
<td>8 (8.6%)</td>
</tr>
<tr class="even">
<td class="rowlabel">(40,50]</td>
<td>9 (30.0%)</td>
<td>18 (28.6%)</td>
<td>27 (29.0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">(50,60]</td>
<td>4 (13.3%)</td>
<td>11 (17.5%)</td>
<td>15 (16.1%)</td>
</tr>
<tr class="even">
<td class="rowlabel">(60,70]</td>
<td>2 (6.7%)</td>
<td>14 (22.2%)</td>
<td>16 (17.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">(70,80]</td>
<td>2 (6.7%)</td>
<td>4 (6.3%)</td>
<td>6 (6.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Missing</td>
<td class="lastrow">2 (6.7%)</td>
<td class="lastrow">5 (7.9%)</td>
<td class="lastrow">7 (7.5%)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="finaldata-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="finaldata-interpretation">Finaldata interpretation:</h2>
<p>Ninety-three subjects were included, of whom 63 (67.7%) were diagnosed with ulcerative colitis (UC) and 30 (32.3%) with histologically normal mucosa (controls).</p>
<p>The mean age of the UC group was 50.9 ± 15.9 years, while the control group had a median age of 47 years (range 17-84). In terms of age distribution, the trend is for a higher percentage of subjects older than 60 years in the UC group (22.2% vs.&nbsp;6.7%).</p>
<p>Laboratory parameters for neutrophilis and albumin were present only in a small portion of the UC group, in 4 and 3 subjects respectively, and were completely absent in the control group. They will therefore not be considered in subsequent investigations.</p>
<p>The predominant ethnicity in the dataset is Caucasian (90.3%), followed by Asian (3.2% all in the UC group) and Jewish (6.5% all in the control group)</p>
<p>In the UC group, 9.5% were current smokers, 34.9% were former smokers, and 52.4% had never smoked (and 3.2% were unknown). While in the control group, this variable was absent in 100% of cases.</p>
<p>Similarly, other concomitant conditions were reported only in the UC group, where 60.3% had no comorbidities and 39.7% reported at least one extraintestinal condition, while this information was missing in 100% of controls.</p>
<p>The most frequently sampled anatomical sites are approximately equal in the two groups and include:</p>
<ul>
<li><p>sigmoid colon (62.4%)</p></li>
<li><p>ascending colon (17.2%)</p></li>
<li><p>descending colon (14.0%)</p></li>
<li><p>terminal ileum (6.5%)</p></li>
</ul>
<p>In the UC group, 54.0% of the samples came from macroscopically inflamed mucosa, while in the control group only 10%</p>
<p>Almost all subjects in the dataset (98.8% and 93.5%, respectively) did not have any joint problems or a family history of inflammatory bowel disease (IBD).</p>
<p>As for relatives affected by IBD, they are present only in the UC group (4 patients with 1 or 2 affected relatives), while they are totally absent in the control group.</p>
</section>
<section id="featuredata" class="level2">
<h2 class="anchored" data-anchor-id="featuredata">Featuredata:</h2>
<p>here we gather featuredata and investigate which information is available about the gene meta data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>feat_all<span class="ot">&lt;-</span>featuredata<span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(ID)), <span class="co"># Convert ID fields to numeric</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">COL=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(COL)),  <span class="co"># Array column index</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ROW=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(ROW)), <span class="co"># Array row index</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">GENE=</span><span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(GENE)), <span class="co"># Internal gene ID</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">CONTROL_TYPE=</span><span class="fu">factor</span>(CONTROL_TYPE), <span class="co"># Convert control-type field to factor</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create binary indicators (Yes/No) for the presence of annotation fields</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_NAME=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(NAME)<span class="sc">|</span>NAME<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_SPOT_ID=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(SPOT_ID)<span class="sc">|</span>SPOT_ID<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_REFSEQ=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(REFSEQ)<span class="sc">|</span>REFSEQ<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_GB_ACC=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(GB_ACC)<span class="sc">|</span>GB_ACC<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_GENE_SYMBOL=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(GENE_SYMBOL)<span class="sc">|</span>GENE_SYMBOL<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_GENE_NAME=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(GENE_NAME)<span class="sc">|</span>GENE_NAME<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_UNIGENE=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(UNIGENE_ID)<span class="sc">|</span>UNIGENE_ID<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_ENSEMBL=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(ENSEMBL_ID)<span class="sc">|</span>ENSEMBL_ID<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_TIGR=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(TIGR_ID)<span class="sc">|</span>TIGR_ID<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_ACCESSION=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(ACCESSION_STRING)<span class="sc">|</span>ACCESSION_STRING<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_CHR_LOC=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(CHROMOSOMAL_LOCATION)<span class="sc">|</span>CHROMOSOMAL_LOCATION<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_CYTOBAND=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(CYTOBAND)<span class="sc">|</span>CYTOBAND<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_DESCRIPTION=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(DESCRIPTION)<span class="sc">|</span>DESCRIPTION<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_GO=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(GO_ID)<span class="sc">|</span>GO_ID<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>)),</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">HAS_SEQUENCE=</span><span class="fu">factor</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(SEQUENCE)<span class="sc">|</span>SEQUENCE<span class="sc">==</span><span class="st">""</span>,<span class="st">"No"</span>,<span class="st">"Yes"</span>))</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Labels for table1</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>ID)<span class="ot">&lt;-</span><span class="st">"Probe ID"</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>COL)<span class="ot">&lt;-</span><span class="st">"Array column index"</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>ROW)<span class="ot">&lt;-</span><span class="st">"Array row index"</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>GENE)<span class="ot">&lt;-</span><span class="st">"Internal gene ID"</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>CONTROL_TYPE)<span class="ot">&lt;-</span><span class="st">"Control type"</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_NAME)<span class="ot">&lt;-</span><span class="st">"Has probe NAME"</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_SPOT_ID)<span class="ot">&lt;-</span><span class="st">"Has SPOT_ID"</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_REFSEQ)<span class="ot">&lt;-</span><span class="st">"Has RefSeq ID"</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_GB_ACC)<span class="ot">&lt;-</span><span class="st">"Has GenBank accession"</span></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_GENE_SYMBOL)<span class="ot">&lt;-</span><span class="st">"Has gene symbol"</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_GENE_NAME)<span class="ot">&lt;-</span><span class="st">"Has gene name"</span></span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_UNIGENE)<span class="ot">&lt;-</span><span class="st">"Has UniGene ID"</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_ENSEMBL)<span class="ot">&lt;-</span><span class="st">"Has Ensembl ID"</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_TIGR)<span class="ot">&lt;-</span><span class="st">"Has TIGR ID"</span></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_ACCESSION)<span class="ot">&lt;-</span><span class="st">"Has accession string"</span></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_CHR_LOC)<span class="ot">&lt;-</span><span class="st">"Has chromosomal location"</span></span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_CYTOBAND)<span class="ot">&lt;-</span><span class="st">"Has cytoband"</span></span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_DESCRIPTION)<span class="ot">&lt;-</span><span class="st">"Has description"</span></span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_GO)<span class="ot">&lt;-</span><span class="st">"Has GO annotation"</span></span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(feat_all<span class="sc">$</span>HAS_SEQUENCE)<span class="ot">&lt;-</span><span class="st">"Has probe sequence"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating a table for summarizing the gene meta data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table1</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> CONTROL_TYPE <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    HAS_REFSEQ <span class="sc">+</span> HAS_GB_ACC <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    HAS_GENE_NAME <span class="sc">+</span> HAS_UNIGENE <span class="sc">+</span> HAS_ENSEMBL <span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    HAS_TIGR <span class="sc">+</span> HAS_ACCESSION <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    HAS_CHR_LOC <span class="sc">+</span> HAS_CYTOBAND <span class="sc">+</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    HAS_DESCRIPTION <span class="sc">+</span> HAS_GO <span class="sc">+</span> HAS_SEQUENCE</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span> HAS_GENE_SYMBOL,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> feat_all</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="Rtable1">
<table class="Rtable1 caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">No<br>
<span class="stratn">(N=881)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Yes<br>
<span class="stratn">(N=2028)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Overall<br>
<span class="stratn">(N=2909)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">Control type</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">FALSE</td>
<td class="lastrow">881 (100%)</td>
<td class="lastrow">2028 (100%)</td>
<td class="lastrow">2909 (100%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Has RefSeq ID</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>814 (92.4%)</td>
<td>167 (8.2%)</td>
<td>981 (33.7%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">67 (7.6%)</td>
<td class="lastrow">1861 (91.8%)</td>
<td class="lastrow">1928 (66.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Has GenBank accession</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">No</td>
<td>421 (47.8%)</td>
<td>0 (0%)</td>
<td>421 (14.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">460 (52.2%)</td>
<td class="lastrow">2028 (100%)</td>
<td class="lastrow">2488 (85.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Has gene name</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>881 (100%)</td>
<td>0 (0%)</td>
<td>881 (30.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">0 (0%)</td>
<td class="lastrow">2028 (100%)</td>
<td class="lastrow">2028 (69.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Has UniGene ID</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">No</td>
<td>472 (53.6%)</td>
<td>23 (1.1%)</td>
<td>495 (17.0%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">409 (46.4%)</td>
<td class="lastrow">2005 (98.9%)</td>
<td class="lastrow">2414 (83.0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Has Ensembl ID</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>733 (83.2%)</td>
<td>275 (13.6%)</td>
<td>1008 (34.7%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">148 (16.8%)</td>
<td class="lastrow">1753 (86.4%)</td>
<td class="lastrow">1901 (65.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Has TIGR ID</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">No</td>
<td>402 (45.6%)</td>
<td>77 (3.8%)</td>
<td>479 (16.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">479 (54.4%)</td>
<td class="lastrow">1951 (96.2%)</td>
<td class="lastrow">2430 (83.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Has accession string</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>240 (27.2%)</td>
<td>0 (0%)</td>
<td>240 (8.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">641 (72.8%)</td>
<td class="lastrow">2028 (100%)</td>
<td class="lastrow">2669 (91.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Has chromosomal location</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">No</td>
<td>42 (4.8%)</td>
<td>6 (0.3%)</td>
<td>48 (1.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">839 (95.2%)</td>
<td class="lastrow">2022 (99.7%)</td>
<td class="lastrow">2861 (98.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Has cytoband</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>61 (6.9%)</td>
<td>15 (0.7%)</td>
<td>76 (2.6%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">820 (93.1%)</td>
<td class="lastrow">2013 (99.3%)</td>
<td class="lastrow">2833 (97.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Has description</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">No</td>
<td>342 (38.8%)</td>
<td>0 (0%)</td>
<td>342 (11.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">539 (61.2%)</td>
<td class="lastrow">2028 (100%)</td>
<td class="lastrow">2567 (88.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Has GO annotation</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">No</td>
<td>821 (93.2%)</td>
<td>427 (21.1%)</td>
<td>1248 (42.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">60 (6.8%)</td>
<td class="lastrow">1601 (78.9%)</td>
<td class="lastrow">1661 (57.1%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Has probe sequence</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Yes</td>
<td class="lastrow">881 (100%)</td>
<td class="lastrow">2028 (100%)</td>
<td class="lastrow">2909 (100%)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="featuredata-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="featuredata-interpretation">Featuredata interpretation:</h2>
<p>This table does not tell us anything about expression values ​​or UC vs control differences, however it can provide us with valuable information regarding the quality of the probe annotations.</p>
<ul>
<li><p>Group sizes:<br>
Normal group: 881<br>
UC group: 2028<br>
Overall: 2909</p></li>
<li><p>Control type (CONTROL_TYPE = FALSE):<br>
Normal group: 881/881 (100%)<br>
UC group: 2028/2028 (100%)<br>
Overall: 2909/2909 (100%)</p></li>
<li><p>Has RefSeq ID:<br>
Normal group: No 814 (92.4%), Yes 67 (7.6%)<br>
UC group: No 167 (8.2%), Yes 1861 (91.8%)<br>
Overall: No 981 (33.7%), Yes 1928 (66.3%)</p></li>
<li><p>Has GenBank accession:<br>
Normal group: No 421 (47.8%), Yes 460 (52.2%)<br>
UC group: No 0 (0%), Yes 2028 (100%)<br>
Overall: No 421 (14.5%), Yes 2488 (85.5%)</p></li>
<li><p>Has gene name:<br>
Normal group: No 881 (100%), Yes 0 (0%)<br>
UC group: No 0 (0%), Yes 2028 (100%)<br>
Overall: No 881 (30.3%), Yes 2028 (69.7%)</p></li>
<li><p>Has UniGene ID:<br>
Normal group: No 472 (53.6%), Yes 409 (46.4%)<br>
UC group: No 23 (1.1%), Yes 2005 (98.9%)<br>
Overall: No 495 (17.0%), Yes 2414 (83.0%)</p></li>
<li><p>Has Ensembl ID:<br>
Normal group: No 733 (83.2%), Yes 148 (16.8%)<br>
UC group: No 275 (13.6%), Yes 1753 (86.4%)<br>
Overall: No 1008 (34.7%), Yes 1901 (65.3%)</p></li>
<li><p>Has TIGR ID:<br>
Normal group: No 402 (45.6%), Yes 479 (54.4%)<br>
UC group: No 77 (3.8%), Yes 1951 (96.2%)<br>
Overall: No 479 (16.5%), Yes 2430 (83.5%)</p></li>
<li><p>Has accession string:<br>
Normal group: No 240 (27.2%), Yes 641 (72.8%)<br>
UC group: No 0 (0%), Yes 2028 (100%)<br>
Overall: No 240 (8.3%), Yes 2669 (91.7%)</p></li>
<li><p>Has chromosomal location:<br>
Normal group: No 42 (4.8%), Yes 839 (95.2%)<br>
UC group: No 6 (0.3%), Yes 2022 (99.7%)<br>
Overall: No 48 (1.7%), Yes 2861 (98.4%)</p></li>
<li><p>Has cytoband:<br>
Normal group: No 61 (6.9%), Yes 820 (93.1%)<br>
UC group: No 15 (0.7%), Yes 2013 (99.3%)<br>
Overall: No 76 (2.6%), Yes 2833 (97.4%)</p></li>
<li><p>Has description:<br>
Normal group: No 342 (38.8%), Yes 539 (61.2%)<br>
UC group: No 0 (0%), Yes 2028 (100%)<br>
Overall: No 342 (11.8%), Yes 2567 (88.2%)</p></li>
<li><p>Has GO annotation:<br>
Normal group: No 821 (93.2%), Yes 60 (6.8%)<br>
UC group: No 427 (21.1%), Yes 1601 (78.9%)<br>
Overall: No 1248 (42.9%), Yes 1661 (57.1%)</p></li>
<li><p>Has probe sequence:<br>
Normal group: Yes 881 (100%)<br>
UC group: Yes 2028 (100%)<br>
Overall: Yes 2909 (100%)</p></li>
</ul>
</section>
<section id="cleaning-environment-2" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-environment-2">Cleaning environment:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analysis-1" class="level1">
<h1>Analysis 1</h1>
<section id="loading-libraries-5" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-5">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggrepel"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-finaldata-featuredata-and-de_results" class="level2">
<h2 class="anchored" data-anchor-id="loading-finaldata-featuredata-and-de_results">Loading finaldata, featuredata and de_results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>finaldata   <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_dat_aug.csv.gz"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>featuredata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/featuredata.csv.gz"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>de_results <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_de_results.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overall-gene-expression-distribution" class="level2">
<h2 class="anchored" data-anchor-id="overall-gene-expression-distribution">Overall gene expression distribution</h2>
<p>To get an idea of the distribution of the genes between samples categorized as either inflamed or uninflamed, we make a histogram (see Figure X), which shows that they have a normal distribution around with a mean slightly above 0. However both distributions appear similar, though the count of genes with uninflamed is higher.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inflammation_status =</span> <span class="fu">factor</span>(inflammation_status,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Uninflamed"</span>, <span class="st">"Inflamed"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gene_expr, <span class="at">fill =</span> inflammation_status)) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">bins =</span> <span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Inflammation state"</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of gene expression in inflamed and uninflamed samples"</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 47900 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/distribution_gene_expression_inflamed_uninflamed-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"distribution_gene_expression_inflamed_uninflamed.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 47900 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
</div>
</section>
<section id="expression-by-anatomic-location-and-inflammation" class="level2">
<h2 class="anchored" data-anchor-id="expression-by-anatomic-location-and-inflammation"><strong>Expression by anatomic location and inflammation</strong></h2>
<p>We then try to get an idea, if there is a difference in the gene expression pattern across anatomic locations i.e.&nbsp;different parts of the intestinal tract and whether or not the sample was inflamed or not. From this plot it is not clear, so we explore further.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>loc_counts <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(anatomic_location)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> anatomic_location, <span class="at">y =</span> gene_expr, </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> inflammation_status)) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">outlier.shape =</span> <span class="cn">NA</span>,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="cf">function</span>(x) {</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(x, <span class="st">" (n = "</span>, loc_counts<span class="sc">$</span>n[<span class="fu">match</span>(x, loc_counts<span class="sc">$</span>anatomic_location)], <span class="st">")"</span>)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Anatomic location"</span>,</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Gene expression"</span>,</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Inflammation state"</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 47900 rows containing non-finite outside the scale range
(`stat_ydensity()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 47900 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/gene_expression_by_anatomic_location_and_inflammation-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"gene_expression_by_anatomic_location_and_inflammation.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 47900 rows containing non-finite outside the scale range
(`stat_ydensity()`).
Removed 47900 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
</div>
</section>
<section id="mean-gene-expression-per-patient-across-in-inflamed-and-un-inflamed-samples" class="level2">
<h2 class="anchored" data-anchor-id="mean-gene-expression-per-patient-across-in-inflamed-and-un-inflamed-samples">Mean gene expression per patient across in inflamed and un-inflamed samples</h2>
<p>We now examine the mean gene expression between inflamed and un-inflamed samples on a patient basis, to see if that showcases a difference in gene expression. The mean gene expression is lower for the un-inflamed patients than for the inflamed patients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>patient_means <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(patient, inflammation_status) <span class="sc">|&gt;</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_expr =</span> <span class="fu">mean</span>(gene_expr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(patient_means, <span class="fu">aes</span>(<span class="at">x =</span> inflammation_status, <span class="at">y =</span> mean_expr)) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Inflammation status"</span>, <span class="at">y =</span> <span class="st">"Mean gene expression per patient"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/mean_gene_expression_per_patient_inflamed_uninflamed-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"mean_gene_expression_per_patient_inflamed_uninflamed.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="identification-of-significant-genes-during-dependent-on-inflammation-state-using-a-volcano-plot" class="level2">
<h2 class="anchored" data-anchor-id="identification-of-significant-genes-during-dependent-on-inflammation-state-using-a-volcano-plot">Identification of significant genes during dependent on inflammation state using a Volcano plot</h2>
<p>Creating a volcano plot to see which genes are significantly (p &lt; 0.05 ) up-regulated in the un-inflamed and inflamed patients. The biologically relevant genes are selected (the ones with a minimum of log2 fold change of 0.25). The blue dots represent the genes that are significantly up-regulated in un-inflamed patients and the red dots represent the genes that are significantly up-regulated in the inflamed patients. They grey dots represent the genes that did not show any significant up-regulation. The genes that are very significantly up-regulated (p &gt; 10^-10) are labeled.</p>
<p>As can be seen in the plot, there are more genes that are up-regulated in inflamed patients than in non-inflamed patients. Some of the genes that are strongly up-regulated are associated with the immune system, e.g.&nbsp;LCN2 and IGHG1, suggesting increased immune activation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>lfc_cut <span class="ot">&lt;-</span> <span class="fl">0.25</span>   <span class="co"># Minimum |log2FC|</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>p_cut   <span class="ot">&lt;-</span> <span class="fl">0.05</span>   <span class="co"># p-value threshold</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Add gene symbol by matching finaldata$gene_id with featuredata$ID</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>de_results_annot <span class="ot">&lt;-</span> de_results <span class="sc">|&gt;</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">GENE_SYMBOL =</span> featuredata<span class="sc">$</span>GENE_SYMBOL[</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">match</span>(gene_id, featuredata<span class="sc">$</span>ID)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Label only highly significant genes with valid symbols</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>label_df <span class="ot">&lt;-</span> de_results_annot <span class="sc">|&gt;</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    neg_log10_p <span class="sc">&gt;</span> <span class="dv">10</span>,</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(GENE_SYMBOL)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Prepare plotting data</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> de_results_annot <span class="sc">|&gt;</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value)) <span class="sc">|&gt;</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">FDR =</span> <span class="fu">p.adjust</span>(p_value, <span class="at">method =</span> <span class="st">"BH"</span>),</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig_cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>      FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> log2FC <span class="sc">&gt;=</span>  lfc_cut <span class="sc">~</span> <span class="st">"Up in inflamed"</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>      FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> log2FC <span class="sc">&lt;=</span> <span class="sc">-</span>lfc_cut <span class="sc">~</span> <span class="st">"Up in uninflamed"</span>,</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                            <span class="sc">~</span> <span class="st">"Non significant"</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig_cat =</span> <span class="fu">factor</span>(sig_cat,</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Up in inflamed"</span>, <span class="st">"Up in uninflamed"</span>, <span class="st">"Non significant"</span>))</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>sig_genes <span class="ot">&lt;-</span> plot_df <span class="sc">|&gt;</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sig_cat <span class="sc">!=</span> <span class="st">"Non significant"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gene_id, GENE_SYMBOL, log2FC, p_value, FDR, sig_cat) <span class="sc">|&gt;</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(FDR)</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="co">#Split into up in inflamed / up in uninflamed</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>up_in_inflamed <span class="ot">&lt;-</span> sig_genes <span class="sc">|&gt;</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sig_cat <span class="sc">==</span> <span class="st">"Up in inflamed"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GENE_SYMBOL)</span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>up_in_uninflamed <span class="ot">&lt;-</span> sig_genes <span class="sc">|&gt;</span></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sig_cat <span class="sc">==</span> <span class="st">"Up in uninflamed"</span>) <span class="sc">|&gt;</span></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GENE_SYMBOL)</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Volcano plot</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_df,</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> log2FC, <span class="at">y =</span> neg_log10_p, <span class="at">colour =</span> sig_cat)) <span class="sc">+</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Points</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Cutoff lines</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(p_cut),</span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span>lfc_cut, lfc_cut),</span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels</span></span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> label_df,</span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> GENE_SYMBOL),</span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">30</span>,</span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.4</span>,</span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.3</span>,</span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.size =</span> <span class="fl">0.2</span>,</span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Up in inflamed"</span>   <span class="ot">=</span> <span class="st">"#d73027"</span>,</span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Up in uninflamed"</span> <span class="ot">=</span> <span class="st">"#4575b4"</span>,</span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Non significant"</span>               <span class="ot">=</span> <span class="st">"grey80"</span></span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Volcano plot of colonic gene expression"</span>,</span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Inflamed vs uninflamed biopsies (Gut 57:1398–1405)"</span>,</span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"log2 fold change (Inflamed – Uninflamed)"</span>,</span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="sc">-</span>log[<span class="dv">10</span>](<span class="fu">italic</span>(p)<span class="sc">~</span>value))</span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb81-85"><a href="#cb81-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb81-86"><a href="#cb81-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/volcano_plot_colonic_gene_expression-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"volcano_plot_colonic_gene_expression.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="expression-of-the-40-most-significant-genes" class="level2">
<h2 class="anchored" data-anchor-id="expression-of-the-40-most-significant-genes">Expression of the 40 most significant genes</h2>
<p>Plotting the expression of the 40 most significant genes in both inflamed and un-inflamed patients. The inflamed patients have a higher expression of some of the genes associated with immune activation compared to the un-inflamed patients. This is for example LCN2 and IGHG1 which is in compliance with the results from the volcano plot. Some of the genes that are down-regulated include GCNT2 and UGT2A3 which are housekeeping genes that are suppressed to free up resources.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pick top 40 most significant genes</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>top_markers <span class="ot">&lt;-</span> sig_genes <span class="sc">|&gt;</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(FDR, <span class="at">n =</span> <span class="dv">40</span>) <span class="sc">|&gt;</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gene_id, GENE_SYMBOL)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Join</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>heat_df <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(top_markers, <span class="at">by =</span> <span class="st">"gene_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(GENE_SYMBOL)) <span class="sc">|&gt;</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(patient, inflammation_status, GENE_SYMBOL, gene_expr) <span class="sc">|&gt;</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">patient =</span> <span class="fu">factor</span>(patient))     <span class="co">#Make patient discrete</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Reorder symbols by average expression difference</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>symbol_order <span class="ot">&lt;-</span> heat_df <span class="sc">|&gt;</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GENE_SYMBOL) <span class="sc">|&gt;</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_expr =</span> <span class="fu">mean</span>(gene_expr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_expr)) <span class="sc">|&gt;</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GENE_SYMBOL)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>heat_df<span class="sc">$</span>GENE_SYMBOL <span class="ot">&lt;-</span> <span class="fu">factor</span>(heat_df<span class="sc">$</span>GENE_SYMBOL, <span class="at">levels =</span> symbol_order)</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a><span class="co"># draw heatmap</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(heat_df,</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> patient, <span class="at">y =</span> GENE_SYMBOL, <span class="at">fill =</span> gene_expr)) <span class="sc">+</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> inflammation_status, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">space =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Patient"</span>,</span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Gene symbol"</span>,</span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Expression"</span>,</span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 40 differential genes across samples"</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid   =</span> <span class="fu">element_blank</span>()</span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/top40_differential_genes_across_samples-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"top40_differential_genes_across_samples.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-between-time-untreated-and-gene-expression" class="level2">
<h2 class="anchored" data-anchor-id="correlation-between-time-untreated-and-gene-expression">Correlation between time untreated and gene expression</h2>
<p>Plotting the correlation between the time patients went untreated and the gene expression of significant genes. Looking at the genes that were up-regulated in inflamed patients (red) it can be seen that some of the patients with the genes that were the most up-regulated went to the doctor earlier compared to some of the patients that had genes that were the least up-regulated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gene_id <span class="sc">==</span> sig_genes<span class="sc">$</span>gene_id) <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(geo_accession, gene_id, time_untreated, disease, family_history) <span class="sc">|&gt;</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sig_genes, finaldata, <span class="at">by =</span> <span class="st">"gene_id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GENE_SYMBOL) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_untreated <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time_untreated, <span class="at">y =</span> log2FC, </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> sig_cat)) <span class="sc">+</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Correlation between time untreated and expression of significant genes"</span>, <span class="at">x =</span> <span class="st">"Time untreated (days)"</span>, <span class="at">y =</span> <span class="st">"log2FC"</span>, <span class="at">color =</span> <span class="st">"Inflammation status"</span>) <span class="sc">+</span> </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `filter()`.
ℹ In argument: `gene_id == sig_genes$gene_id`.
Caused by warning in `gene_id == sig_genes$gene_id`:
! longer object length is not a multiple of shorter object length</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/correlation_time_untreated_significant_genes-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"correlation_time_untreated_significant_genes.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-environment-3" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-environment-3">Cleaning environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analysis-3" class="level1">
<h1>Analysis 3</h1>
<section id="loading-libraries-6" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-6">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-finaldata-and-featuredata-2" class="level2">
<h2 class="anchored" data-anchor-id="loading-finaldata-and-featuredata-2">Loading finaldata and featuredata</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_dat_aug.csv.gz"</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>featuredata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/featuredata.csv.gz"</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"99_proj_func.R"</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(finaldata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "geo_accession"          "patient"                "current_medication"    
 [4] "birth_date"             "ethnicity"              "symptoms_onset_date"   
 [7] "diagnosis_date"         "time_untreated"         "joint_problems"        
[10] "uc_flare_up"            "family_history"         "neutrophils"           
[13] "albumin"                "ibd_affected_relatives" "smoking_status"        
[16] "smoking_start_date"     "smoking_stop_date"      "smoking_amount"        
[19] "other_illnesses"        "disease"                "anatomic_location"     
[22] "inflammation_status"    "procedure_date"         "age"                   
[25] "age_group"              "gene_id"                "gene_expr"             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(featuredata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ID"                   "COL"                  "ROW"                 
 [4] "NAME"                 "SPOT_ID"              "CONTROL_TYPE"        
 [7] "REFSEQ"               "GB_ACC"               "GENE"                
[10] "GENE_SYMBOL"          "GENE_NAME"            "UNIGENE_ID"          
[13] "ENSEMBL_ID"           "TIGR_ID"              "ACCESSION_STRING"    
[16] "CHROMOSOMAL_LOCATION" "CYTOBAND"             "DESCRIPTION"         
[19] "GO_ID"                "SEQUENCE"            </code></pre>
</div>
</div>
</section>
<section id="looking-at-age-groups" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-age-groups">Looking at age groups</h2>
<section id="correlation-between-age-group-and-diagnosis-time" class="level3">
<h3 class="anchored" data-anchor-id="correlation-between-age-group-and-diagnosis-time">Correlation between age group and diagnosis time</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="sc">|&gt;</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(geo_accession, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_group)) <span class="sc">|&gt;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">fill =</span> inflammation_status))<span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">"single"</span>, <span class="at">padding =</span> <span class="dv">0</span>), </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">labs</span>(</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age groups"</span>,</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"n"</span>,</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Inflammation-status"</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/age_groups_distribution_inflammation_status-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"age_groups_distribution_inflammation_status.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="age-group-and-diagnosis-time" class="level2">
<h2 class="anchored" data-anchor-id="age-group-and-diagnosis-time">Age group and diagnosis time</h2>
<p>Plotting the correlation between the different age groups and diagnosis time to see, if there is a correlation between the two. Although the medians in the age groups are all similar, some patients in the age group (50,60) takes a long time to get diagnosed. The patients in the age group (30,40] takes the shortest time to get diagnosed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="sc">|&gt;</span>  </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_group)) <span class="sc">|&gt;</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(time_untreated)) <span class="sc">|&gt;</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_untreated <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">|&gt;</span> </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  age_group     n
  &lt;chr&gt;     &lt;int&gt;
1 (20,30]   31999
2 (30,40]   17454
3 (40,50]   98906
4 (50,60]   43635
5 (60,70]   46544
6 (70,80]    8727</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="sc">|&gt;</span>  </span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(age_group)) <span class="sc">|&gt;</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(time_untreated)) <span class="sc">|&gt;</span> </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_untreated <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">|&gt;</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> time_untreated)) <span class="sc">+</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age Groups"</span>,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Time to diagnostics (days)"</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Time from 1st UC symtomps to diagnostics against age"</span>) <span class="sc">+</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/time_to_diagnosis_vs_age-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"time_to_diagnosis_vs_age.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="impact-of-smoking-on-inflammation-status" class="level2">
<h2 class="anchored" data-anchor-id="impact-of-smoking-on-inflammation-status">Impact of smoking on inflammation status</h2>
<section id="correlation-between-gene-expression-inflammation-status-and-smoking-status" class="level3">
<h3 class="anchored" data-anchor-id="correlation-between-gene-expression-inflammation-status-and-smoking-status">Correlation between gene expression, inflammation status and smoking status</h3>
<p>Plotting the correlation between gene expression, inflammation status and smoking status. Most patients are either ex-smokers or have never smoked. The group of patients thats do smoke as well as the ones that have never smoked have a slightly higher subset that are inflamed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="sc">|&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(geo_accession, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(smoking_status)) <span class="sc">|&gt;</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> smoking_status, </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> inflammation_status)) <span class="sc">+</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">preserve =</span> <span class="st">"single"</span>, <span class="at">padding =</span> <span class="dv">0</span>),</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">+</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Smoking status"</span>, <span class="at">y =</span> <span class="st">"n"</span>, <span class="at">fill =</span> <span class="st">"Inflammation-status"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/gene_expression_by_smoking_status_and_inflammation-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"gene_expression_by_smoking_status_and_inflammation.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-between-smoking-and-the-diagnosis-time" class="level3">
<h3 class="anchored" data-anchor-id="correlation-between-smoking-and-the-diagnosis-time">Correlation between smoking and the diagnosis time</h3>
<p>Plotting to see the correlation between patients that are smokers and how long it takes for them to get diagnosed. The patient group that whose smoking habits are unknown takes the shortest time to get diagnosed, followed by the current smokers. The group of patients that have never smoked takes the longest time to get diagnosed. However, since the “smoker” group and the “unknown” group are the much smaller than the “ex” and the “never” group, the results may be unreliable. Moreover, there are two three outliers in the plot who have all taken a very long time to get diagnosed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="sc">|&gt;</span>  </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(smoking_status)) <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(time_untreated)) <span class="sc">|&gt;</span> </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_untreated <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(smoking_status) <span class="sc">|&gt;</span> </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  smoking_status      n
  &lt;chr&gt;           &lt;int&gt;
1 current         17454
2 ex             113451
3 never          116360
4 unknown          8727</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>finaldata <span class="sc">|&gt;</span>  </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(smoking_status)) <span class="sc">|&gt;</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(time_untreated)) <span class="sc">|&gt;</span> </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_untreated <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(smoking_status) <span class="sc">|&gt;</span> </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> smoking_status, <span class="at">y =</span> time_untreated)) <span class="sc">+</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Smoking Status"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Time to diagnostics (days)"</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Time from 1st UC symtomps to diagnostics against smoking"</span>) <span class="sc">+</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/time_to_diagnosis_vs_smoking_status-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"time_to_diagnosis_vs_smoking_status.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="significance-based-on-anatomical-location" class="level2">
<h2 class="anchored" data-anchor-id="significance-based-on-anatomical-location">Significance based on anatomical location</h2>
<p>The graph shows that significant variations in expression between inflamed and non-inflamed samples appear only in the descending colon and sigmoid colon. In the ascending colon, the differences do not exceed the significance threshold, while in the terminal ileum, the inflamed samples are too few to make a reliable comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>de_by_loc <span class="ot">&lt;-</span> finaldata <span class="sc">|&gt;</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(gene_expr, inflammation_status, anatomic_location)) <span class="sc">|&gt;</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inflammation_status =</span> <span class="fu">factor</span>(inflammation_status,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">c</span>(<span class="st">"Uninflamed"</span>, <span class="st">"Inflamed"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anatomic_location, gene_id) <span class="sc">|&gt;</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Keep only genes where both groups are present in that location</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(inflammation_status) <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">log2FC  =</span> <span class="fu">mean</span>(gene_expr[inflammation_status <span class="sc">==</span> <span class="st">"Inflamed"</span>],   <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mean</span>(gene_expr[inflammation_status <span class="sc">==</span> <span class="st">"Uninflamed"</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> <span class="fu">tryCatch</span>(</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t.test</span>(gene_expr <span class="sc">~</span> inflammation_status)<span class="sc">$</span>p.value,</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anatomic_location) <span class="sc">|&gt;</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">FDR =</span> <span class="fu">p.adjust</span>(p_value, <span class="st">"BH"</span>),</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig =</span> <span class="sc">!</span><span class="fu">is.na</span>(FDR) <span class="sc">&amp;</span> FDR <span class="sc">&lt;</span> <span class="fl">0.05</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>de_by_loc <span class="sc">|&gt;</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(anatomic_location, sig) <span class="sc">|&gt;</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(anatomic_location, n, <span class="at">fill =</span> sig)) <span class="sc">+</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/significant_gene_counts_by_anatomic_location-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"significant_gene_count_by_anatomic_location.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-environment-4" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-environment-4">Cleaning environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analysis-4" class="level1">
<h1>Analysis 4</h1>
<section id="loading-libraries-7" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-7">Loading libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6969</span>) <span class="co">#Setting seed for reproducability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>expr_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_rf_expr_df.csv.gz"</span>) <span class="co">#used for input nodes</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>featuredata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_dat_genbank.csv.gz"</span>) <span class="co">#used for classifier target</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>de_results <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_de_results.csv.gz"</span>) <span class="co">#required for vulcano plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-training" class="level2">
<h2 class="anchored" data-anchor-id="model-training">Model Training</h2>
<section id="splitting-dataset-into-train-and-test" class="level3">
<h3 class="anchored" data-anchor-id="splitting-dataset-into-train-and-test">Splitting dataset into train and test</h3>
<p>We start by splitting the data into train and test data sets. The model is allowed to “learn” correlations on train, and it’s performance can then be evaluated using test_data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>percent_train <span class="ot">&lt;-</span> <span class="fl">0.8</span> <span class="co">#use 80% of the data for train </span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(expr_df), <span class="fl">0.8</span> <span class="sc">*</span> <span class="fu">nrow</span>(expr_df))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> expr_df[train_index, ]</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> expr_df[<span class="sc">-</span>train_index, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Its important that the model never “sees” the test data, as we need the model performance metrics to be truly independent. This reduces the chance of the model fitting to correlations specific to the data values, rather than a biological signal.</p>
</section>
<section id="running-the-rf-classifier-model" class="level3">
<h3 class="anchored" data-anchor-id="running-the-rf-classifier-model">Running the RF Classifier model</h3>
<p>The target value “y_pred_UC” for the model is whether the sample was from an individual with (1) or without (0) UC. This column is prepared previously in 03_augment.qmd.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#y_pred_UC as factor was not implemented in 03_augment, despite the use of as.factor()</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_data <span class="sc">|&gt;</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_pred_UC =</span> <span class="fu">as.factor</span>(y_pred_UC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each gene is its own input node for the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># y_pred_UC ~ . </span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>train_data.rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(y_pred_UC <span class="sc">~</span> . <span class="sc">-</span> geo_accession, </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">type =</span> <span class="st">"classification"</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> train_data, </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mtry =</span> <span class="dv">3</span>,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="co"># importance = True is used to obtain most contributing inputs; aka genes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model Evaluation</h2>
<section id="deriving-the-confusion-matrix-of-the-rf-model" class="level3">
<h3 class="anchored" data-anchor-id="deriving-the-confusion-matrix-of-the-rf-model">Deriving the Confusion Matrix of the RF model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>test_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(train_data.rf, test_data)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> test_pred, <span class="at">Actual =</span> test_data<span class="sc">$</span>y_pred_UC)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Actual
Predicted  0  1
        0  6  6
        1  3 26</code></pre>
</div>
</div>
<p>Confusion matrix shows the amount of times the model predicted 0 or 1 (rows), based on the actual values of 0 or 1 in the test dataset. It therefore shows:</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td style="text-align: center;">TN</td>
<td style="text-align: center;">FN</td>
</tr>
<tr class="even">
<td style="text-align: center;">FP</td>
<td style="text-align: center;">TP</td>
</tr>
</tbody>
</table>
<p>where;</p>
<ul>
<li><p>TN: True Negative</p></li>
<li><p>FN: False Negative</p></li>
<li><p>FP: False Positive</p></li>
<li><p>TP: True Positive</p></li>
</ul>
<p>From the matrix, we can obtain an accuracy score.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Correct predictions; TN, TP</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>TN <span class="ot">&lt;-</span> confusion_matrix[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>TP <span class="ot">&lt;-</span> confusion_matrix[<span class="dv">2</span>, <span class="dv">2</span>]</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>FP <span class="ot">&lt;-</span> confusion_matrix[<span class="dv">2</span>, <span class="dv">1</span>]</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>FN <span class="ot">&lt;-</span> confusion_matrix[<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">sum</span>(confusion_matrix)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>acc <span class="ot">&lt;-</span> (TN<span class="sc">+</span>TP)<span class="sc">/</span>total</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(acc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7804878</code></pre>
</div>
</div>
<p>The model emitted a 78% accuracy.</p>
</section>
<section id="importance-measure-of-genes" class="level3">
<h3 class="anchored" data-anchor-id="importance-measure-of-genes">Importance measure of Genes</h3>
<p>We would like to find the model contributing genes in the model, to see which genes (at least in the eyes of the model), speaks to samples with and without UC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>var_importance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">round</span>(<span class="fu">importance</span>(train_data.rf), <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>var_importance <span class="ot">&lt;-</span> var_importance <span class="sc">|&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gene_id =</span> <span class="fu">str_split_i</span>(<span class="fu">rownames</span>(var_importance), <span class="st">"_"</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">GENE_SYMBOL =</span> featuredata<span class="sc">$</span>GENE_SYMBOL[</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">match</span>(gene_id, featuredata<span class="sc">$</span>ID)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>var_importance <span class="sc">|&gt;</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(gene_id = str_split_i(rownames(var_importance), "_", 2)) |&gt; </span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MeanDecreaseAccuracy)) <span class="sc">|&gt;</span> </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use reorder() to automatically sort the bars by the MeanDecreaseAccuracy value</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">reorder</span>(GENE_SYMBOL, MeanDecreaseAccuracy), </span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> MeanDecreaseAccuracy</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 15 Most Contributing Genes in RF"</span>,</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Gene"</span>,</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean decrease accuracy from RF"</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-130-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"top15_most_contributing_genes_RF.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Extract gene_ids as list</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>most_contributing_vars <span class="ot">&lt;-</span> var_importance <span class="sc">|&gt;</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(MeanDecreaseAccuracy)) <span class="sc">|&gt;</span> </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>) <span class="sc">|&gt;</span> </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="match-gene_id-with-gene_symbol-to-match-other-analysis" class="level3">
<h3 class="anchored" data-anchor-id="match-gene_id-with-gene_symbol-to-match-other-analysis">Match gene_id with gene_symbol to match other analysis</h3>
<p>GENE_SYMBOL can be found in featuredata. This is used to map to the results of the vulcano plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Splitting gene_id into only the number and converting to numeric</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>most_contributing_vars <span class="ot">&lt;-</span> most_contributing_vars <span class="sc">|&gt;</span> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split_i</span>(<span class="st">"_"</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_number</span>()</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>most_contributing_vars <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(most_contributing_vars)</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>most_contributing_vars <span class="ot">&lt;-</span> most_contributing_vars <span class="sc">|&gt;</span> </span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> most_contributing_vars) <span class="sc">|&gt;</span> </span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>most_contributing_gene_symbols <span class="ot">&lt;-</span> featuredata <span class="sc">|&gt;</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, GENE_SYMBOL) <span class="sc">|&gt;</span> </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(most_contributing_vars, featuredata, <span class="at">by=</span><span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GENE_SYMBOL) <span class="sc">|&gt;</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(GENE_SYMBOL)) <span class="sc">|&gt;</span> </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GENE_SYMBOL)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(most_contributing_gene_symbols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CDH24"    "S100A5"   "PLB1"     "PREI3"    "EGR1"     "DEFA5"   
 [7] "C8orf46"  "KIAA0484" "IGFBP2"   "RHBDL1"   "MSTP9"    "RSNL2"   
[13] "PTGDS"    "SGK2"    </code></pre>
</div>
</div>
</section>
</section>
<section id="comparison-of-identified-genes-impacting-inflammation-with-disease-state" class="level2">
<h2 class="anchored" data-anchor-id="comparison-of-identified-genes-impacting-inflammation-with-disease-state">Comparison of identified genes impacting inflammation with disease state</h2>
<p>To visualize overlay between significant genes found in 05_analysis, and the RandomForest model most contributing variables.</p>
<p>The 05_analysis relied on inflammation status, and the model relied on disease state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>de_results <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/03_de_results.csv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>lfc_cut <span class="ot">&lt;-</span> <span class="fl">0.25</span>   <span class="co"># minimum |log2FC|</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>p_cut   <span class="ot">&lt;-</span> <span class="fl">0.05</span>   <span class="co"># p-value threshold for the dashed line</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add gene symbol by matching finaldata$gene_id --&gt; featuredata$ID</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>de_results_annot <span class="ot">&lt;-</span> de_results <span class="sc">|&gt;</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">GENE_SYMBOL =</span> featuredata<span class="sc">$</span>GENE_SYMBOL[</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">match</span>(gene_id, featuredata<span class="sc">$</span>ID)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Label only highly significant genes with valid symbols</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a>label_df <span class="ot">&lt;-</span> de_results_annot <span class="sc">|&gt;</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>    neg_log10_p <span class="sc">&gt;</span> <span class="dv">10</span>,         </span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(GENE_SYMBOL)</span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare plotting data</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> de_results_annot <span class="sc">|&gt;</span></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(p_value)) <span class="sc">|&gt;</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">FDR =</span> <span class="fu">p.adjust</span>(p_value, <span class="at">method =</span> <span class="st">"BH"</span>),</span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig_cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a>      FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> log2FC <span class="sc">&gt;=</span>  lfc_cut <span class="sc">~</span> <span class="st">"Up in inflamed"</span>,</span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>      FDR <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> log2FC <span class="sc">&lt;=</span> <span class="sc">-</span>lfc_cut <span class="sc">~</span> <span class="st">"Up in uninflamed"</span>,</span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span>                           <span class="sc">~</span> <span class="st">"Non significant"</span></span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig_cat =</span> <span class="fu">factor</span>(sig_cat,</span>
<span id="cb127-30"><a href="#cb127-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Up in inflamed"</span>, <span class="st">"Up in uninflamed"</span>, <span class="st">"Non significant"</span>)),</span>
<span id="cb127-31"><a href="#cb127-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb127-32"><a href="#cb127-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify genes from the highlight list</span></span>
<span id="cb127-33"><a href="#cb127-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlight_cat =</span> <span class="fu">case_when</span>(</span>
<span id="cb127-34"><a href="#cb127-34" aria-hidden="true" tabindex="-1"></a>      GENE_SYMBOL <span class="sc">%in%</span> most_contributing_gene_symbols <span class="sc">~</span> <span class="st">"Most Contributing"</span>,</span>
<span id="cb127-35"><a href="#cb127-35" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb127-36"><a href="#cb127-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb127-37"><a href="#cb127-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb127-38"><a href="#cb127-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-39"><a href="#cb127-39" aria-hidden="true" tabindex="-1"></a>sig_genes <span class="ot">&lt;-</span> plot_df <span class="sc">|&gt;</span></span>
<span id="cb127-40"><a href="#cb127-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sig_cat <span class="sc">!=</span> <span class="st">"Non significant"</span>) <span class="sc">|&gt;</span></span>
<span id="cb127-41"><a href="#cb127-41" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(gene_id, GENE_SYMBOL, log2FC, p_value, FDR, sig_cat) <span class="sc">|&gt;</span></span>
<span id="cb127-42"><a href="#cb127-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(FDR)</span>
<span id="cb127-43"><a href="#cb127-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-44"><a href="#cb127-44" aria-hidden="true" tabindex="-1"></a><span class="co"># split into up in inflamed / up in uninflamed</span></span>
<span id="cb127-45"><a href="#cb127-45" aria-hidden="true" tabindex="-1"></a>up_in_inflamed <span class="ot">&lt;-</span> sig_genes <span class="sc">|&gt;</span></span>
<span id="cb127-46"><a href="#cb127-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sig_cat <span class="sc">==</span> <span class="st">"Up in inflamed"</span>) <span class="sc">|&gt;</span></span>
<span id="cb127-47"><a href="#cb127-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GENE_SYMBOL)</span>
<span id="cb127-48"><a href="#cb127-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-49"><a href="#cb127-49" aria-hidden="true" tabindex="-1"></a>up_in_uninflamed <span class="ot">&lt;-</span> sig_genes <span class="sc">|&gt;</span></span>
<span id="cb127-50"><a href="#cb127-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sig_cat <span class="sc">==</span> <span class="st">"Up in uninflamed"</span>) <span class="sc">|&gt;</span></span>
<span id="cb127-51"><a href="#cb127-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(GENE_SYMBOL)</span>
<span id="cb127-52"><a href="#cb127-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-53"><a href="#cb127-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Volcano plot with Highlighted Genes</span></span>
<span id="cb127-54"><a href="#cb127-54" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_df,</span>
<span id="cb127-55"><a href="#cb127-55" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> log2FC, <span class="at">y =</span> neg_log10_p)) <span class="sc">+</span></span>
<span id="cb127-56"><a href="#cb127-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-57"><a href="#cb127-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Base points (coloured by sig_cat)</span></span>
<span id="cb127-58"><a href="#cb127-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_cat), <span class="at">size =</span> <span class="fl">1.3</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb127-59"><a href="#cb127-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-60"><a href="#cb127-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Overlay highlighted genes (colored by highlight_cat)</span></span>
<span id="cb127-61"><a href="#cb127-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">filter</span>(plot_df, highlight_cat <span class="sc">==</span> <span class="st">"Most Contributing"</span>),</span>
<span id="cb127-62"><a href="#cb127-62" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> highlight_cat),</span>
<span id="cb127-63"><a href="#cb127-63" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb127-64"><a href="#cb127-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-65"><a href="#cb127-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cutoff lines</span></span>
<span id="cb127-66"><a href="#cb127-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(p_cut),</span>
<span id="cb127-67"><a href="#cb127-67" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb127-68"><a href="#cb127-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="sc">-</span>lfc_cut, lfc_cut),</span>
<span id="cb127-69"><a href="#cb127-69" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb127-70"><a href="#cb127-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-71"><a href="#cb127-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels for strongest hits</span></span>
<span id="cb127-72"><a href="#cb127-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb127-73"><a href="#cb127-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> label_df,</span>
<span id="cb127-74"><a href="#cb127-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> GENE_SYMBOL),</span>
<span id="cb127-75"><a href="#cb127-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb127-76"><a href="#cb127-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb127-77"><a href="#cb127-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.overlaps =</span> <span class="dv">30</span>,</span>
<span id="cb127-78"><a href="#cb127-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.4</span>,</span>
<span id="cb127-79"><a href="#cb127-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.3</span>,</span>
<span id="cb127-80"><a href="#cb127-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">segment.size =</span> <span class="fl">0.2</span>,</span>
<span id="cb127-81"><a href="#cb127-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb127-82"><a href="#cb127-82" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb127-83"><a href="#cb127-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-84"><a href="#cb127-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unified color scale (sig categories + highlighted category)</span></span>
<span id="cb127-85"><a href="#cb127-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb127-86"><a href="#cb127-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb127-87"><a href="#cb127-87" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Up in inflamed"</span>   <span class="ot">=</span> <span class="st">"#d73027"</span>,</span>
<span id="cb127-88"><a href="#cb127-88" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Up in uninflamed"</span> <span class="ot">=</span> <span class="st">"#4575b4"</span>,</span>
<span id="cb127-89"><a href="#cb127-89" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Non significant"</span>  <span class="ot">=</span> <span class="st">"grey80"</span>,</span>
<span id="cb127-90"><a href="#cb127-90" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Most Contributing"</span> <span class="ot">=</span> <span class="st">"green"</span></span>
<span id="cb127-91"><a href="#cb127-91" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb127-92"><a href="#cb127-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb127-93"><a href="#cb127-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb127-94"><a href="#cb127-94" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Up in inflamed"</span>   <span class="ot">=</span> <span class="st">"Up in inflamed"</span>,</span>
<span id="cb127-95"><a href="#cb127-95" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Up in uninflamed"</span> <span class="ot">=</span> <span class="st">"Up in uninflamed"</span>,</span>
<span id="cb127-96"><a href="#cb127-96" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Non significant"</span>  <span class="ot">=</span> <span class="st">"Non significant"</span>,</span>
<span id="cb127-97"><a href="#cb127-97" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Most Contributing"</span> <span class="ot">=</span> <span class="st">"Genes affecting UC diagnosis present in RF model"</span></span>
<span id="cb127-98"><a href="#cb127-98" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb127-99"><a href="#cb127-99" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb127-100"><a href="#cb127-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-101"><a href="#cb127-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb127-102"><a href="#cb127-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Volcano plot of colonic gene expression"</span>,</span>
<span id="cb127-103"><a href="#cb127-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Inflamed vs uninflamed biopsies (Gut 57:1398–1405)"</span>,</span>
<span id="cb127-104"><a href="#cb127-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"log2 fold change (Inflamed – Uninflamed)"</span>,</span>
<span id="cb127-105"><a href="#cb127-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="sc">-</span>log[<span class="dv">10</span>](<span class="fu">italic</span>(p)<span class="sc">~</span>value))</span>
<span id="cb127-106"><a href="#cb127-106" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb127-107"><a href="#cb127-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb127-108"><a href="#cb127-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb127-109"><a href="#cb127-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-110"><a href="#cb127-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb127-111"><a href="#cb127-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb127-112"><a href="#cb127-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb127-113"><a href="#cb127-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb127-114"><a href="#cb127-114" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="00_all_files/figure-html/unnamed-chunk-135-1.svg" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"volcano_plot_colonic_gene_expression_RF.png"</span>, <span class="at">path =</span> <span class="st">"../results"</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">12</span>, <span class="at">units =</span> <span class="st">"cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-environment-5" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-environment-5">Cleaning environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>