---
title: "04_describe"
format: html
---

# Describing

## Loading libraries

```{r}
#| message: false
#| warning: false

library("dplyr")
library("table1")
library("tidyverse")
```

## Loading finaldata and featuredata

```{r}
#| message: false
#| warning: false
finaldata   <- read_csv("../data/03_dat_aug.csv.gz")
featuredata <- read_csv("../data/featuredata.csv.gz")
```

## Finaldata:

Here we select all the the meta data to make a table, so we get an entry for each patient, in order to see their smoking habits, ethnicity, blood status and more.

```{r}
fin_all<-finaldata|>
  select(
    patient,
    ethnicity,
    joint_problems,
    uc_flare_up,
    family_history,
    neutrophils,
    albumin,
    ibd_affected_relatives,
    smoking_status,
    smoking_amount,
    other_illnesses,
    disease,
    anatomic_location,
    inflammation_status,
    age,
    age_group
  )|>
  distinct(patient,.keep_all=TRUE)|>  
  # Keep one record per patient (remove duplicates if multiple biopsies exist)
  mutate(
    neutrophils=suppressWarnings(as.numeric(neutrophils)),  
    # Convert to numeric; non-numeric values become NA
    albumin=suppressWarnings(as.numeric(albumin)),
    smoking_amount=suppressWarnings(as.numeric(smoking_amount)),
    age=suppressWarnings(as.numeric(age)),
    
    #factors
    ethnicity=factor(ethnicity),    # Convert categorical variables to factors
    joint_problems=factor(joint_problems),
    uc_flare_up=factor(uc_flare_up),
    family_history=factor(family_history),
    ibd_affected_relatives=factor(ibd_affected_relatives),
    smoking_status=factor(smoking_status),
    disease=factor(disease),
    anatomic_location=factor(anatomic_location),
    inflammation_status=factor(inflammation_status),
    age_group=factor(age_group)
  )

fin_all$neutrophils[fin_all$neutrophils==0]<-NA   # Replace 0 with NA
fin_all$albumin[fin_all$albumin==0]<-NA

fin_all$other_illnesses_clean<-dplyr::case_when(   # Clean comorbidity field into a simple binary variable
  is.na(fin_all$other_illnesses)~NA_character_,
  fin_all$other_illnesses%in%c("none","None","NONE")~"None",
  TRUE~"Any comorbidity"
)

fin_all$other_illnesses_clean<-factor(             
  # Convert cleaned comorbidity variable to factor
  fin_all$other_illnesses_clean,
  levels=c("None","Any comorbidity")
)

label(fin_all$neutrophils)<-"Neutrophils"    # Labels for table1() formatting
label(fin_all$albumin)<-"Albumin"
label(fin_all$ethnicity)<-"Ethnicity"
label(fin_all$joint_problems)<-"Joint problems"
label(fin_all$uc_flare_up)<-"UC flare-up"
label(fin_all$family_history)<-"Family history of IBD"
label(fin_all$ibd_affected_relatives)<-"IBD-affected relatives"
label(fin_all$smoking_status)<-"Smoking status"
label(fin_all$other_illnesses_clean)<-"Other illnesses"
label(fin_all$disease)<-"Disease group"
label(fin_all$anatomic_location)<-"Anatomic location"
label(fin_all$inflammation_status)<-"Inflammation status"
label(fin_all$age)<-"Age"
label(fin_all$age_group)<-"Age group"
```

Here we create a table of the data using the `table1` package using the variables shown in the code.

```{r}
table1(
  ~ age + neutrophils + albumin +
    ethnicity + smoking_status + other_illnesses_clean +
    anatomic_location + inflammation_status + joint_problems +
    family_history + ibd_affected_relatives +
    age_group
  | disease,
  data = fin_all
)
```

## Finaldata interpretation:

Ninety-three subjects were included, of whom 63 (67.7%) were diagnosed with ulcerative colitis (UC) and 30 (32.3%) with histologically normal mucosa (controls).

The mean age of the UC group was 50.9 ± 15.9 years, while the control group had a median age of 47 years (range 17-84). In terms of age distribution, the trend is for a higher percentage of subjects older than 60 years in the UC group (22.2% vs. 6.7%).

Laboratory parameters for neutrophilis and albumin were present only in a small portion of the UC group, in 4 and 3 subjects respectively, and were completely absent in the control group. They will therefore not be considered in subsequent investigations.

The predominant ethnicity in the dataset is Caucasian (90.3%), followed by Asian (3.2% all in the UC group) and Jewish (6.5% all in the control group)

In the UC group, 9.5% were current smokers, 34.9% were former smokers, and 52.4% had never smoked (and 3.2% were unknown). While in the control group, this variable was absent in 100% of cases.

Similarly, other concomitant conditions were reported only in the UC group, where 60.3% had no comorbidities and 39.7% reported at least one extraintestinal condition, while this information was missing in 100% of controls.

The most frequently sampled anatomical sites are approximately equal in the two groups and include:

-   sigmoid colon (62.4%)

-   ascending colon (17.2%)

-   descending colon (14.0%)

-   terminal ileum (6.5%)

In the UC group, 54.0% of the samples came from macroscopically inflamed mucosa, while in the control group only 10%

Almost all subjects in the dataset (98.8% and 93.5%, respectively) did not have any joint problems or a family history of inflammatory bowel disease (IBD).

As for relatives affected by IBD, they are present only in the UC group (4 patients with 1 or 2 affected relatives), while they are totally absent in the control group.

## Featuredata:

here we gather featuredata and investigate which information is available about the gene meta data.

```{r}
feat_all<-featuredata|>
  mutate(
    ID=suppressWarnings(as.numeric(ID)), # Convert ID fields to numeric
    COL=suppressWarnings(as.numeric(COL)),  # Array column index
    ROW=suppressWarnings(as.numeric(ROW)), # Array row index
    GENE=suppressWarnings(as.numeric(GENE)), # Internal gene ID

    CONTROL_TYPE=factor(CONTROL_TYPE), # Convert control-type field to factor

    # Create binary indicators (Yes/No) for the presence of annotation fields
    HAS_NAME=factor(ifelse(is.na(NAME)|NAME=="","No","Yes")),
    HAS_SPOT_ID=factor(ifelse(is.na(SPOT_ID)|SPOT_ID=="","No","Yes")),
    HAS_REFSEQ=factor(ifelse(is.na(REFSEQ)|REFSEQ=="","No","Yes")),
    HAS_GB_ACC=factor(ifelse(is.na(GB_ACC)|GB_ACC=="","No","Yes")),
    HAS_GENE_SYMBOL=factor(ifelse(is.na(GENE_SYMBOL)|GENE_SYMBOL=="","No","Yes")),
    HAS_GENE_NAME=factor(ifelse(is.na(GENE_NAME)|GENE_NAME=="","No","Yes")),
    HAS_UNIGENE=factor(ifelse(is.na(UNIGENE_ID)|UNIGENE_ID=="","No","Yes")),
    HAS_ENSEMBL=factor(ifelse(is.na(ENSEMBL_ID)|ENSEMBL_ID=="","No","Yes")),
    HAS_TIGR=factor(ifelse(is.na(TIGR_ID)|TIGR_ID=="","No","Yes")),
    HAS_ACCESSION=factor(ifelse(is.na(ACCESSION_STRING)|ACCESSION_STRING=="","No","Yes")),
    HAS_CHR_LOC=factor(ifelse(is.na(CHROMOSOMAL_LOCATION)|CHROMOSOMAL_LOCATION=="","No","Yes")),
    HAS_CYTOBAND=factor(ifelse(is.na(CYTOBAND)|CYTOBAND=="","No","Yes")),
    HAS_DESCRIPTION=factor(ifelse(is.na(DESCRIPTION)|DESCRIPTION=="","No","Yes")),
    HAS_GO=factor(ifelse(is.na(GO_ID)|GO_ID=="","No","Yes")),
    HAS_SEQUENCE=factor(ifelse(is.na(SEQUENCE)|SEQUENCE=="","No","Yes"))
  )

# Labels for table1
label(feat_all$ID)<-"Probe ID"
label(feat_all$COL)<-"Array column index"
label(feat_all$ROW)<-"Array row index"
label(feat_all$GENE)<-"Internal gene ID"
label(feat_all$CONTROL_TYPE)<-"Control type"
label(feat_all$HAS_NAME)<-"Has probe NAME"
label(feat_all$HAS_SPOT_ID)<-"Has SPOT_ID"
label(feat_all$HAS_REFSEQ)<-"Has RefSeq ID"
label(feat_all$HAS_GB_ACC)<-"Has GenBank accession"
label(feat_all$HAS_GENE_SYMBOL)<-"Has gene symbol"
label(feat_all$HAS_GENE_NAME)<-"Has gene name"
label(feat_all$HAS_UNIGENE)<-"Has UniGene ID"
label(feat_all$HAS_ENSEMBL)<-"Has Ensembl ID"
label(feat_all$HAS_TIGR)<-"Has TIGR ID"
label(feat_all$HAS_ACCESSION)<-"Has accession string"
label(feat_all$HAS_CHR_LOC)<-"Has chromosomal location"
label(feat_all$HAS_CYTOBAND)<-"Has cytoband"
label(feat_all$HAS_DESCRIPTION)<-"Has description"
label(feat_all$HAS_GO)<-"Has GO annotation"
label(feat_all$HAS_SEQUENCE)<-"Has probe sequence"
```

Creating a table for summarizing the gene meta data.

```{r}
table1(
  ~ CONTROL_TYPE +
    HAS_REFSEQ + HAS_GB_ACC +
    HAS_GENE_NAME + HAS_UNIGENE + HAS_ENSEMBL +
    HAS_TIGR + HAS_ACCESSION +
    HAS_CHR_LOC + HAS_CYTOBAND +
    HAS_DESCRIPTION + HAS_GO + HAS_SEQUENCE
  | HAS_GENE_SYMBOL,
  data = feat_all
)
```

## Featuredata interpretation:

This table does not tell us anything about expression values ​​or UC vs control differences, however it can provide us with valuable information regarding the quality of the probe annotations.

-   Group sizes:\
    Normal group: 881\
    UC group: 2028\
    Overall: 2909

-   Control type (CONTROL_TYPE = FALSE):\
    Normal group: 881/881 (100%)\
    UC group: 2028/2028 (100%)\
    Overall: 2909/2909 (100%)

-   Has RefSeq ID:\
    Normal group: No 814 (92.4%), Yes 67 (7.6%)\
    UC group: No 167 (8.2%), Yes 1861 (91.8%)\
    Overall: No 981 (33.7%), Yes 1928 (66.3%)

-   Has GenBank accession:\
    Normal group: No 421 (47.8%), Yes 460 (52.2%)\
    UC group: No 0 (0%), Yes 2028 (100%)\
    Overall: No 421 (14.5%), Yes 2488 (85.5%)

-   Has gene name:\
    Normal group: No 881 (100%), Yes 0 (0%)\
    UC group: No 0 (0%), Yes 2028 (100%)\
    Overall: No 881 (30.3%), Yes 2028 (69.7%)

-   Has UniGene ID:\
    Normal group: No 472 (53.6%), Yes 409 (46.4%)\
    UC group: No 23 (1.1%), Yes 2005 (98.9%)\
    Overall: No 495 (17.0%), Yes 2414 (83.0%)

-   Has Ensembl ID:\
    Normal group: No 733 (83.2%), Yes 148 (16.8%)\
    UC group: No 275 (13.6%), Yes 1753 (86.4%)\
    Overall: No 1008 (34.7%), Yes 1901 (65.3%)

-   Has TIGR ID:\
    Normal group: No 402 (45.6%), Yes 479 (54.4%)\
    UC group: No 77 (3.8%), Yes 1951 (96.2%)\
    Overall: No 479 (16.5%), Yes 2430 (83.5%)

-   Has accession string:\
    Normal group: No 240 (27.2%), Yes 641 (72.8%)\
    UC group: No 0 (0%), Yes 2028 (100%)\
    Overall: No 240 (8.3%), Yes 2669 (91.7%)

-   Has chromosomal location:\
    Normal group: No 42 (4.8%), Yes 839 (95.2%)\
    UC group: No 6 (0.3%), Yes 2022 (99.7%)\
    Overall: No 48 (1.7%), Yes 2861 (98.4%)

-   Has cytoband:\
    Normal group: No 61 (6.9%), Yes 820 (93.1%)\
    UC group: No 15 (0.7%), Yes 2013 (99.3%)\
    Overall: No 76 (2.6%), Yes 2833 (97.4%)

-   Has description:\
    Normal group: No 342 (38.8%), Yes 539 (61.2%)\
    UC group: No 0 (0%), Yes 2028 (100%)\
    Overall: No 342 (11.8%), Yes 2567 (88.2%)

-   Has GO annotation:\
    Normal group: No 821 (93.2%), Yes 60 (6.8%)\
    UC group: No 427 (21.1%), Yes 1601 (78.9%)\
    Overall: No 1248 (42.9%), Yes 1661 (57.1%)

-   Has probe sequence:\
    Normal group: Yes 881 (100%)\
    UC group: Yes 2028 (100%)\
    Overall: Yes 2909 (100%)

## Cleaning environment:

```{r}
rm(list = ls())
```
