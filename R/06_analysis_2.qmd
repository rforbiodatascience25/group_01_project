---
title: "06_analysis_2"
format: html
---

```{r}
#| message: false
#| warning: false
finaldata <- read_csv("../data/03_dat_aug.csv.gz")
featuredata <- read_csv("../data/featuredata.csv.gz")
```

```{r}
finaldata |> 
    filter(!is.na(age_group)) |>
    ggplot(mapping = aes(x = age_group, fill = inflammation_status))+
       geom_bar(position = position_dodge2(preserve = "single", padding = 0), 
        color = "black", 
        alpha = 0.4)+
      theme_minimal(base_size = 10) +
      theme(
        legend.position = "bottom"
     ) +
     labs(
       x = "Age groups",
        y = "n",
       fill = "Inflammation-status"
      )
```

```{r}
finaldata |>
  filter(!is.na(smoking_status)) |> 
  ggplot(aes(x = smoking_status, y = gene_expr, 
             fill = inflammation_status)) +
  geom_violin(trim = FALSE, alpha = 0.5) +
  geom_boxplot(width = 0.15, outlier.shape = NA, position = position_dodge(width = 0.9)) +
  coord_flip() +
  theme_minimal() +
  labs(x = "Smoking status", y = "Gene expression")
```

```{r}
time_untreated_data <- finaldata |> 
  filter(gene_id == sig_genes$gene_id) |> 
  select(geo_accession, gene_id, time_untreated, disease, family_history) |> 
  left_join(sig_genes, finaldata, by = "gene_id")
```

```{r}
time_untreated_data |>
  group_by(GENE_SYMBOL) %>% filter(n() >= 2) |> 
  filter(time_untreated > 0) |> 
  ggplot(aes(x = time_untreated, y = log2FC, 
             color = sig_cat)) +
  geom_point(alpha = 0.5) +
  theme_minimal() +
  labs(title = "Correlation between time untreated and expression of significant genes", x = "Time untreated (days)", y = "log2FC", color = "Inflammation status") + 
  theme(legend.position = "bottom")
```

> > > > > > > 23cf40d79c24f7355740e3ec783ef96a3789d909
